import{o as n,c as s,a}from"./app.a88d1aa8.js";const p='{"title":"MMLAB","description":"","frontmatter":{},"headers":[{"level":2,"title":"1. 模块一：分类任务基本操作","slug":"_1-模块一：分类任务基本操作"},{"level":3,"title":"1.基本参数配置解读","slug":"_1-基本参数配置解读"},{"level":3,"title":"2. 各模块配置文件组成","slug":"_2-各模块配置文件组成"},{"level":3,"title":"3. 生成完整的配置文件","slug":"_3-生成完整的配置文件"},{"level":3,"title":"4. 根据文件夹自定义数据集","slug":"_4-根据文件夹自定义数据集"},{"level":3,"title":"5. 构建自己的数据集","slug":"_5-构建自己的数据集"},{"level":3,"title":"6. 问题","slug":"_6-问题"},{"level":2,"title":"2. 模块一：训练结果测试与验证","slug":"_2-模块一：训练结果测试与验证"},{"level":3,"title":"1. 测试demo效果","slug":"_1-测试demo效果"},{"level":3,"title":"2. 测试评估模型效果","slug":"_2-测试评估模型效果"},{"level":3,"title":"3. MMLS中新增模块","slug":"_3-mmls中新增模块"},{"level":3,"title":"4. 数据增强可视化模块","slug":"_4-数据增强可视化模块"},{"level":3,"title":"5. 模型分析脚本","slug":"_5-模型分析脚本"},{"level":2,"title":"3. 模块一：模型源码debug","slug":"_3-模块一：模型源码debug"},{"level":3,"title":"1. VIT任务概述","slug":"_1-vit任务概述"},{"level":2,"title":"4. 模块二：使用分割模块训练自己的数据集","slug":"_4-模块二：使用分割模块训练自己的数据集"},{"level":3,"title":"1. 数据集标注","slug":"_1-数据集标注"},{"level":3,"title":"2. 预测类别数修改配置文件","slug":"_2-预测类别数修改配置文件"},{"level":3,"title":"3. 开始训练","slug":"_3-开始训练"},{"level":3,"title":"4. 预测demo","slug":"_4-预测demo"},{"level":2,"title":"5. 模块二：基于Unet进行各种策略修改","slug":"_5-模块二：基于unet进行各种策略修改"},{"level":3,"title":"1. 配置文件解读","slug":"_1-配置文件解读"},{"level":3,"title":"优化","slug":"优化"},{"level":2,"title":"6. 第二模块：（论文）分割任务CVPR最新Backbone设计及其应用","slug":"_6-第二模块：（论文）分割任务cvpr最新backbone设计及其应用"},{"level":3,"title":"1. 注册自己的Backbone","slug":"_1-注册自己的backbone"},{"level":3,"title":"2. 配置文件指定","slug":"_2-配置文件指定"},{"level":3,"title":"3. debug解读backbone","slug":"_3-debug解读backbone"},{"level":3,"title":"4. patchembedding作用和实现","slug":"_4-patchembedding作用和实现"},{"level":3,"title":"5. 卷积位置编码计算方法","slug":"_5-卷积位置编码计算方法"},{"level":3,"title":"6. 近似attention实现","slug":"_6-近似attention实现"},{"level":3,"title":"7. 完成特征提取与融合模块","slug":"_7-完成特征提取与融合模块"},{"level":3,"title":"8. 分割任务输出模块","slug":"_8-分割任务输出模块"},{"level":3,"title":"9. 全局特征的作用和实现","slug":"_9-全局特征的作用和实现"},{"level":2,"title":"7. 第三模块：mmdet训练自己的数据任务","slug":"_7-第三模块：mmdet训练自己的数据任务"},{"level":3,"title":"1.数据集标注","slug":"_1-数据集标注-1"},{"level":3,"title":"2. coco数据标注格式","slug":"_2-coco数据标注格式"},{"level":3,"title":"3. 通过脚本生成coco","slug":"_3-通过脚本生成coco"},{"level":3,"title":"4. 配置文件数据增强","slug":"_4-配置文件数据增强"},{"level":3,"title":"5.  训练配置","slug":"_5-训练配置"},{"level":2,"title":"6. 第三模块：DeformableDetr物体检测源码分析","slug":"_6-第三模块：deformabledetr物体检测源码分析"},{"level":2,"title":"7. 第四模块：DBNET文字检测","slug":"_7-第四模块：dbnet文字检测"}],"relativePath":"note/deep_learning/4_MMLab.md","lastUpdated":1689408361035}',t={},o=a('<h1 id="mmlab"><a class="header-anchor" href="#mmlab" aria-hidden="true">#</a> MMLAB</h1><h2 id="_1-模块一：分类任务基本操作"><a class="header-anchor" href="#_1-模块一：分类任务基本操作" aria-hidden="true">#</a> 1. 模块一：分类任务基本操作</h2><p>源码：mmclassification-master</p><h3 id="_1-基本参数配置解读"><a class="header-anchor" href="#_1-基本参数配置解读" aria-hidden="true">#</a> 1.基本参数配置解读</h3><p>configs -&gt; <em>base</em> -&gt; model -&gt; <a href="http://resnet18.py" target="_blank" rel="noopener noreferrer">resnet18.py</a></p><div class="language-python"><pre><code><span class="token comment"># model settings</span>\nmodel <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageClassifier&#39;</span><span class="token punctuation">,</span>\n    <span class="token comment"># 预处理不用改 没那个能力</span>\n    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ResNet&#39;</span><span class="token punctuation">,</span>\n        depth<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span>\n        num_stages<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>\n        out_indices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        style<span class="token operator">=</span><span class="token string">&#39;pytorch&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    neck<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;GlobalAveragePooling&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token comment"># head层 可以在这改</span>\n    head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LinearClsHead&#39;</span><span class="token punctuation">,</span>  <span class="token comment"># 分类任务就用这个</span>\n        num_classes<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>  <span class="token comment"># 分类的数量 要改</span>\n        in_channels<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token comment"># 自己定 输出的特征图</span>\n        loss<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CrossEntropyLoss&#39;</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 可以去尝试修改损失</span>\n        topk<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 评估标准</span>\n    <span class="token punctuation">)</span><span class="token punctuation">)</span>\n</code></pre></div><p>损失在 mmcls-&gt; models -&gt; losses</p><div class="language-python"><pre><code><span class="token comment"># focal_loss</span>\n<span class="token decorator annotation punctuation">@LOSSES<span class="token punctuation">.</span>register_module</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">FocalLoss</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>\n<span class="token comment"># 直接改就行</span>\n</code></pre></div><p>configs -&gt; <em>base</em> -&gt; datasets-&gt; imagenet_bs32</p><div class="language-python"><pre><code>dataset_type <span class="token operator">=</span> <span class="token string">&#39;ImageNet&#39;</span>\nimg_norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n<span class="token comment"># 数据集预处理操作</span>\ntrain_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 读文件</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomResizedCrop&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 随机裁剪成224</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> flip_prob<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> direction<span class="token operator">=</span><span class="token string">&#39;horizontal&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 水平翻转</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span> <span class="token operator">**</span>img_norm_cfg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 归一化</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;gt_label&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 转化成ToTensor</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_label&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> \n<span class="token punctuation">]</span>\ntest_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 害怕训练集太小了</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CenterCrop&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span> <span class="token operator">**</span>img_norm_cfg<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\n<span class="token comment"># 训练的配置</span>\ndata <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    samples_per_gpu<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token comment"># 单卡的话butch_size , 多卡的话每张卡的butch_size</span>\n    workers_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>\n    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span>dataset_type<span class="token punctuation">,</span> <span class="token comment"># 自己去写 两种方法 读数据</span>\n        data_prefix<span class="token operator">=</span><span class="token string">&#39;data/imagenet/train&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span>train_pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span>dataset_type<span class="token punctuation">,</span>\n        data_prefix<span class="token operator">=</span><span class="token string">&#39;data/imagenet/val&#39;</span><span class="token punctuation">,</span>\n        ann_file<span class="token operator">=</span><span class="token string">&#39;data/imagenet/meta/val.txt&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span>test_pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token comment"># replace `data/val` with `data/test` for standard test</span>\n        <span class="token builtin">type</span><span class="token operator">=</span>dataset_type<span class="token punctuation">,</span>\n        data_prefix<span class="token operator">=</span><span class="token string">&#39;data/imagenet/val&#39;</span><span class="token punctuation">,</span>\n        ann_file<span class="token operator">=</span><span class="token string">&#39;data/imagenet/meta/val.txt&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span>test_pipeline<span class="token punctuation">)</span><span class="token punctuation">)</span>\nevaluation <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">&#39;accuracy&#39;</span><span class="token punctuation">)</span>\n</code></pre></div><h3 id="_2-各模块配置文件组成"><a class="header-anchor" href="#_2-各模块配置文件组成" aria-hidden="true">#</a> 2. 各模块配置文件组成</h3><p>策略 优化器：configs -&gt; <em>base</em> -&gt; schedules-&gt; imagenet_bs256</p><div class="language-python"><pre><code><span class="token comment"># optimizer</span>\noptimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SGD&#39;</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>\noptimizer_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>grad_clip<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>\n<span class="token comment"># learning policy 学习率衰减</span>\nlr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>policy<span class="token operator">=</span><span class="token string">&#39;step&#39;</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 迭代30 60 90次衰减</span>\nrunner <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;EpochBasedRunner&#39;</span><span class="token punctuation">,</span> max_epochs<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>\n</code></pre></div><p>默认配置：configs -&gt; <em>base</em> -&gt; schedules-&gt; defalut_runtime</p><div class="language-python"><pre><code><span class="token comment"># checkpoint saving</span>\ncheckpoint_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token comment"># yapf:disable</span>\nlog_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    interval<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>\n    hooks<span class="token operator">=</span><span class="token punctuation">[</span>\n        <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;TextLoggerHook&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment"># dict(type=&#39;TensorboardLoggerHook&#39;)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token comment"># yapf:enable</span>\n\ndist_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">&#39;nccl&#39;</span><span class="token punctuation">)</span>\nlog_level <span class="token operator">=</span> <span class="token string">&#39;INFO&#39;</span>\nload_from <span class="token operator">=</span> <span class="token boolean">None</span>\nresume_from <span class="token operator">=</span> <span class="token boolean">None</span>\nworkflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;train&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n</code></pre></div><h3 id="_3-生成完整的配置文件"><a class="header-anchor" href="#_3-生成完整的配置文件" aria-hidden="true">#</a> 3. 生成完整的配置文件</h3><p>tools -&gt; <a href="http://train.py" target="_blank" rel="noopener noreferrer">train.py</a></p><p>加配置文件</p><div class="language-python"><pre><code><span class="token comment"># D:\\\\mmclassification-master\\configs\\\\resnet\\resnet18_ 8xb32_lin1k.py</span>\n去生成自己的配置文件 然后修改\n</code></pre></div><p>tools -&gt; work_dirs 训练保存文件的位置</p><p>会生成一个 文件修改文件名 放到 configs -&gt; resnet里面去</p><h3 id="_4-根据文件夹自定义数据集"><a class="header-anchor" href="#_4-根据文件夹自定义数据集" aria-hidden="true">#</a> 4. 根据文件夹自定义数据集</h3><p>生成好的配置文件configs -&gt; resnet-&gt;today_resnet18_8xb32_in1k.py</p><div class="language-python"><pre><code>model <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageClassifier&#39;</span><span class="token punctuation">,</span>\n    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ResNet&#39;</span><span class="token punctuation">,</span>\n        depth<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span>\n        num_stages<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>\n        out_indices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        style<span class="token operator">=</span><span class="token string">&#39;pytorch&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    neck<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;GlobalAveragePooling&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LinearClsHead&#39;</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">102</span><span class="token punctuation">,</span>    <span class="token comment"># 输出层 102个花的种类</span>\n        in_channels<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>\n        loss<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;L1Loss&#39;</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#L1Loss CrossEntropyLoss</span>\n        topk<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\ndataset_type <span class="token operator">=</span> <span class="token string">&#39;ImageNet&#39;</span>\nimg_norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\ntrain_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomResizedCrop&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 如果显存太小 可以改小 不要改的太小</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> flip_prob<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> direction<span class="token operator">=</span><span class="token string">&#39;horizontal&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span> \n        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;gt_label&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_label&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\ntest_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CenterCrop&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\ndata <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    samples_per_gpu<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>\n    workers_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>\n    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MyFilelist&#39;</span><span class="token punctuation">,</span>\n        data_prefix<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmclassification-master\\\\mmcls\\\\data\\\\flower_data\\\\train_filelist&#39;</span><span class="token punctuation">,</span> <span class="token comment"># 改成自己的文件夹  训练集</span>\n        ann_file<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmclassification-master\\\\mmcls\\\\data\\\\flower_data\\\\train.txt&#39;</span><span class="token punctuation">,</span> <span class="token comment"># 这个相当于文件名 对应的 标签</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomResizedCrop&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> flip_prob<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> direction<span class="token operator">=</span><span class="token string">&#39;horizontal&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;gt_label&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_label&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageNet&#39;</span><span class="token punctuation">,</span>\n        data_prefix<span class="token operator">=</span><span class="token string">&#39;../mmcls/data/flower_data/val_filelist&#39;</span><span class="token punctuation">,</span>\n        ann_file<span class="token operator">=</span><span class="token string">&#39;../mmcls/data/flower_data/val.txt&#39;</span><span class="token punctuation">,</span> <span class="token comment"># 把他注释掉 就以文件夹为标签名</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CenterCrop&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageNet&#39;</span><span class="token punctuation">,</span>\n        data_prefix<span class="token operator">=</span><span class="token string">&#39;../mmcls/data/flower_data/val_filelist&#39;</span><span class="token punctuation">,</span>\n        ann_file<span class="token operator">=</span><span class="token string">&#39;../mmcls/data/flower_data/val.txt&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CenterCrop&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nevaluation <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">&#39;accuracy&#39;</span><span class="token punctuation">)</span>\noptimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SGD&#39;</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>\noptimizer_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>grad_clip<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>\nlr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>policy<span class="token operator">=</span><span class="token string">&#39;step&#39;</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\nrunner <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;EpochBasedRunner&#39;</span><span class="token punctuation">,</span> max_epochs<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>\ncheckpoint_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token comment"># 隔50保存一次模型</span>\nlog_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> hooks<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;TextLoggerHook&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\ndist_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">&#39;nccl&#39;</span><span class="token punctuation">)</span>\nlog_level <span class="token operator">=</span> <span class="token string">&#39;INFO&#39;</span>\nload_from <span class="token operator">=</span> <span class="token boolean">None</span>\nresume_from <span class="token operator">=</span> <span class="token boolean">None</span>\nworkflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;train&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\nwork_dir <span class="token operator">=</span> <span class="token string">&#39;./work_dirs/resnet18_8xb32_in1k&#39;</span> <span class="token comment"># 工作路径 可以保存模型和日志</span>\ngpu_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\n</code></pre></div><p>运行文件</p><p>还是 在 tools -&gt; <a href="http://train.py" target="_blank" rel="noopener noreferrer">train.py</a></p><p>配置文件改一下pycharm的 debug configuration</p><div class="language-"><pre><code>mmclassification-master\\\\configs\\\\resnet\\\\today_resnet18_8xb32_in1k.py\n</code></pre></div><h3 id="_5-构建自己的数据集"><a class="header-anchor" href="#_5-构建自己的数据集" aria-hidden="true">#</a> 5. 构建自己的数据集</h3><h4 id="方法一"><a class="header-anchor" href="#方法一" aria-hidden="true">#</a> 方法一</h4><p>注意类别从0开始</p><div class="language-python"><pre><code><span class="token comment"># filelist.py</span>\n<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np\n<span class="token keyword">import</span> os\n<span class="token keyword">import</span> shutil\n<span class="token comment"># 根据文件夹分类的数据放到一个文件夹中，并做好标签</span>\n\ntrain_path <span class="token operator">=</span> <span class="token string">&#39;./train&#39;</span>\ntrain_out <span class="token operator">=</span> <span class="token string">&#39;./train.txt&#39;</span>\nval_path <span class="token operator">=</span> <span class="token string">&#39;./valid&#39;</span>\nval_out <span class="token operator">=</span> <span class="token string">&#39;./val.txt&#39;</span>\n\ndata_train_out <span class="token operator">=</span> <span class="token string">&#39;./train_filelist&#39;</span>\ndata_val_out <span class="token operator">=</span> <span class="token string">&#39;./val_filelist&#39;</span>\n\n<span class="token keyword">def</span> <span class="token function">get_filelist</span><span class="token punctuation">(</span>input_path<span class="token punctuation">,</span>output_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_path<span class="token punctuation">,</span><span class="token string">&#39;w&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n        <span class="token keyword">for</span> dir_path<span class="token punctuation">,</span>dir_names<span class="token punctuation">,</span>file_names <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>input_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">if</span> dir_path <span class="token operator">!=</span> input_path<span class="token punctuation">:</span>\n                label <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>dir_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#39;\\\\&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span>\n            <span class="token comment">#print(label)</span>\n            <span class="token keyword">for</span> filename <span class="token keyword">in</span> file_names<span class="token punctuation">:</span>\n                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>filename <span class="token operator">+</span><span class="token string">&#39; &#39;</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\n&quot;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">def</span> <span class="token function">move_imgs</span><span class="token punctuation">(</span>input_path<span class="token punctuation">,</span>output_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> dir_path<span class="token punctuation">,</span> dir_names<span class="token punctuation">,</span> file_names <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>input_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">for</span> filename <span class="token keyword">in</span> file_names<span class="token punctuation">:</span>\n            <span class="token comment">#print(os.path.join(dir_path,filename))</span>\n            source_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>dir_path<span class="token punctuation">,</span>filename<span class="token punctuation">)</span>\n\n            shutil<span class="token punctuation">.</span>copyfile<span class="token punctuation">(</span>source_path<span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>output_path<span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\nget_filelist<span class="token punctuation">(</span>train_path<span class="token punctuation">,</span>train_out<span class="token punctuation">)</span> <span class="token comment"># txt</span>\nget_filelist<span class="token punctuation">(</span>val_path<span class="token punctuation">,</span>val_out<span class="token punctuation">)</span>\nmove_imgs<span class="token punctuation">(</span>train_path<span class="token punctuation">,</span>data_train_out<span class="token punctuation">)</span> <span class="token comment"># 图片放到一个文件夹</span>\nmove_imgs<span class="token punctuation">(</span>val_path<span class="token punctuation">,</span>data_val_out<span class="token punctuation">)</span>\n</code></pre></div><h4 id="方法二"><a class="header-anchor" href="#方法二" aria-hidden="true">#</a> 方法二</h4><p>去mmcls -&gt; datasets -&gt; my_filelist.py</p><div class="language-python"><pre><code><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np\n\n<span class="token keyword">from</span> <span class="token punctuation">.</span>builder <span class="token keyword">import</span> DATASETS\n<span class="token keyword">from</span> <span class="token punctuation">.</span>base_dataset <span class="token keyword">import</span> BaseDataset\n\n<span class="token decorator annotation punctuation">@DATASETS<span class="token punctuation">.</span>register_module</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">MyFilelist</span><span class="token punctuation">(</span>BaseDataset<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token comment"># 这个会用到展示结果上  中文展示不出来</span>\n    CLASSES <span class="token operator">=</span> <span class="token punctuation">[</span>\n        <span class="token string">&#39;我懒得写名字了，有102个。。。&#39;</span><span class="token punctuation">,</span>\n        <span class="token string">&#39;我懒得写名字了，有102个。。。&#39;</span><span class="token punctuation">,</span>\n        <span class="token string">&#39;我懒得写名字了，有102个。。。&#39;</span><span class="token punctuation">,</span>\n        <span class="token string">&#39;我懒得写名字了，有102个。。。&#39;</span><span class="token punctuation">,</span>\n        <span class="token punctuation">]</span>\n    <span class="token comment"># 重写一下这个方法</span>\n    <span class="token keyword">def</span> <span class="token function">load_annotations</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>ann_file<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span>\n\n        data_infos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>ann_file<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n            samples <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n            <span class="token keyword">for</span> filename<span class="token punctuation">,</span> gt_label <span class="token keyword">in</span> samples<span class="token punctuation">:</span>\n                    info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;img_prefix&#39;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>data_prefix<span class="token punctuation">}</span>\n                    info<span class="token punctuation">[</span><span class="token string">&#39;img_info&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;filename&#39;</span><span class="token punctuation">:</span> filename<span class="token punctuation">}</span>\n                    info<span class="token punctuation">[</span><span class="token string">&#39;gt_label&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>gt_label<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>int64<span class="token punctuation">)</span>\n                    data_infos<span class="token punctuation">.</span>append<span class="token punctuation">(</span>info<span class="token punctuation">)</span>\n                <span class="token keyword">return</span> data_infos\n</code></pre></div><p>还需要在 mmcls -&gt; datasets -&gt;<strong>init</strong>.py 把自己文件导进去</p><div class="language-python"><pre><code><span class="token keyword">from</span> <span class="token punctuation">.</span>my_filelist <span class="token keyword">import</span> MyFilelist\n<span class="token comment"># 还有个 MyFilelist</span>\n__all__ <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token string">&#39;BaseDataset&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;ImageNet&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;CIFAR10&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;CIFAR100&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;MNIST&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;FashionMNIST&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;VOC&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;MultiLabelDataset&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;build_dataloader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;build_dataset&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;DistributedSampler&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;ConcatDataset&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;RepeatDataset&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;ClassBalancedDataset&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;DATASETS&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;PIPELINES&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;ImageNet21k&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;SAMPLERS&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;build_sampler&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;RepeatAugSampler&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;KFoldDataset&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;MyFilelist&#39;</span>\n<span class="token punctuation">]</span>\n</code></pre></div><h3 id="_6-问题"><a class="header-anchor" href="#_6-问题" aria-hidden="true">#</a> 6. 问题</h3><p>可能环境有问题 打印日志有问题 降低版本 1.4.7</p><div class="language-python"><pre><code><span class="token comment"># trian.py 打印日志的代码注释</span>\nenv_info_dict <span class="token operator">=</span> collect_env<span class="token punctuation">(</span><span class="token punctuation">)</span>\nenv_info <span class="token operator">=</span> <span class="token string">&#39;\\n&#39;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&#39;</span><span class="token interpolation"><span class="token punctuation">{</span>k<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>v<span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> env_info_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\nmeta<span class="token punctuation">[</span><span class="token string">&#39;env_info&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> env_info\n</code></pre></div><p>102 与 1000</p><p>在 mmcls -&gt; datasets -&gt; <a href="http://imagenet.py" target="_blank" rel="noopener noreferrer">imagenet.py</a></p><div class="language-python"><pre><code><span class="token comment"># 这个CLASSES 随便生成102个东西就行 删掉重新弄</span>\n<span class="token decorator annotation punctuation">@DATASETS<span class="token punctuation">.</span>register_module</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">ImageNet</span><span class="token punctuation">(</span>BaseDataset<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">&quot;&quot;&quot;`ImageNet &lt;http://www.image-net.org&gt;`_ Dataset.\n\n    This implementation is modified from\n    https://github.com/pytorch/vision/blob/master/torchvision/datasets/imagenet.py\n    &quot;&quot;&quot;</span>  <span class="token comment"># noqa: E501</span>\n\n    IMG_EXTENSIONS <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;.jpg&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.jpeg&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.png&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.ppm&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.bmp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.pgm&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.tif&#39;</span><span class="token punctuation">)</span>\n    CLASSES <span class="token operator">=</span> <span class="token punctuation">[</span>\n        <span class="token string">&#39;tench, Tinca tinca&#39;</span><span class="token punctuation">,</span>\n        <span class="token string">&#39;goldfish, Carassius auratus&#39;</span><span class="token punctuation">,</span>\n</code></pre></div><h2 id="_2-模块一：训练结果测试与验证"><a class="header-anchor" href="#_2-模块一：训练结果测试与验证" aria-hidden="true">#</a> 2. 模块一：训练结果测试与验证</h2><h3 id="_1-测试demo效果"><a class="header-anchor" href="#_1-测试demo效果" aria-hidden="true">#</a> 1. 测试demo效果</h3><p>demo -&gt; image_demo.py</p><p>去修改pycharm 的配置 image_05094.jpg ../configs/resnet/today_resnet18_8xb32_in1k.py ../tools/work_dirs/resnet18_8xb32_in1k/epoch_100.pth</p><div class="language-python"><pre><code><span class="token comment"># image_05094.jpg ../configs/resnet/today_resnet18_8xb32_in1k.py ../tools/work_dirs/resnet18_8xb32_in1k/epoch_100.pth</span>\n<span class="token comment"># 最后那个是训练好的模型</span>\n<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    parser <span class="token operator">=</span> ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;Image file&#39;</span><span class="token punctuation">)</span>\n    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;config&#39;</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;Config file&#39;</span><span class="token punctuation">)</span>\n    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&#39;checkpoint&#39;</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;Checkpoint file&#39;</span><span class="token punctuation">)</span>\n    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>\n        <span class="token string">&#39;--device&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">&#39;cuda:0&#39;</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;Device used for inference&#39;</span><span class="token punctuation">)</span>\n    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># build the model from a config file and a checkpoint file</span>\n    model <span class="token operator">=</span> init_model<span class="token punctuation">(</span>args<span class="token punctuation">.</span>config<span class="token punctuation">,</span> args<span class="token punctuation">.</span>checkpoint<span class="token punctuation">,</span> device<span class="token operator">=</span>args<span class="token punctuation">.</span>device<span class="token punctuation">)</span>\n    <span class="token comment"># test a single image</span>\n    result <span class="token operator">=</span> inference_model<span class="token punctuation">(</span>model<span class="token punctuation">,</span> args<span class="token punctuation">.</span>img<span class="token punctuation">)</span>\n    <span class="token comment"># show the results</span>\n    show_result_pyplot<span class="token punctuation">(</span>model<span class="token punctuation">,</span> args<span class="token punctuation">.</span>img<span class="token punctuation">,</span> result<span class="token punctuation">)</span>\n\n\n<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>\n    main<span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre></div><h3 id="_2-测试评估模型效果"><a class="header-anchor" href="#_2-测试评估模型效果" aria-hidden="true">#</a> 2. 测试评估模型效果</h3><p>tools -&gt; <a href="http://test.py" target="_blank" rel="noopener noreferrer">test.py</a></p><p>修改 pycharm的配置</p><p>第一个 把--show删掉 第二个是放文件的位置（这个可以删掉 太慢了） 第三个是评估指标</p><div class="language-python"><pre><code><span class="token comment"># ../configs/resnet/today_resnet18_8xb32_in1k.py ../tools/work_dirs/resnet18_8xb32_in1k/epoch_100.pth</span>\n<span class="token comment">#--show-dir ../tools/work_dirs/resnet18_8xb32_in1k/val_result</span>\n<span class="token comment">#--metrics accuracy recall</span>\n<span class="token keyword">def</span> <span class="token function">parse_args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n</code></pre></div><h3 id="_3-mmls中新增模块"><a class="header-anchor" href="#_3-mmls中新增模块" aria-hidden="true">#</a> 3. MMLS中新增模块</h3><div class="language-python"><pre><code>model <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageClassifier&#39;</span><span class="token punctuation">,</span>\n    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ResNet&#39;</span><span class="token punctuation">,</span>\n        depth<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span>\n        num_stages<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>\n        out_indices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        style<span class="token operator">=</span><span class="token string">&#39;pytorch&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    neck<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;GlobalAveragePooling&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LinearClsHead&#39;</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">102</span><span class="token punctuation">,</span>    <span class="token comment"># 输出层 102个花的种类</span>\n        in_channels<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>\n        <span class="token comment"># 自己设计损失函数</span>\n        loss<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;L1Loss&#39;</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#L1Loss CrossEntropyLoss</span>\n        topk<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\ndataset_type <span class="token operator">=</span> <span class="token string">&#39;ImageNet&#39;</span>\n</code></pre></div><h4 id="自己设计损失函数"><a class="header-anchor" href="#自己设计损失函数" aria-hidden="true">#</a> 自己设计损失函数</h4><p>自己去定义一个 L1Loss</p><div class="language-python"><pre><code><span class="token keyword">import</span> torch\n<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn\n<span class="token keyword">from</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>builder <span class="token keyword">import</span> LOSSES\n<span class="token keyword">from</span> <span class="token punctuation">.</span>utils <span class="token keyword">import</span> weighted_loss\n\n<span class="token decorator annotation punctuation">@weighted_loss</span>\n<span class="token keyword">def</span> <span class="token function">l1_loss</span><span class="token punctuation">(</span>pred<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    target <span class="token operator">=</span> nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>target<span class="token punctuation">,</span>num_classes<span class="token operator">=</span><span class="token number">102</span><span class="token punctuation">)</span>\n    <span class="token keyword">assert</span> pred<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> target<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">and</span> target<span class="token punctuation">.</span>numel<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>\n    loss <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>pred <span class="token operator">-</span> target<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> loss\n\n<span class="token decorator annotation punctuation">@LOSSES<span class="token punctuation">.</span>register_module</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">L1Loss</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> reduction<span class="token operator">=</span><span class="token string">&#39;mean&#39;</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span>L1Loss<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>reduction <span class="token operator">=</span> reduction\n        self<span class="token punctuation">.</span>loss_weight <span class="token operator">=</span> loss_weight\n\n    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>\n                pred<span class="token punctuation">,</span>\n                target<span class="token punctuation">,</span>\n                weight<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n                avg_factor<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n                reduction_override<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">assert</span> reduction_override <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mean&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sum&#39;</span><span class="token punctuation">)</span>\n        reduction <span class="token operator">=</span> <span class="token punctuation">(</span>\n            reduction_override <span class="token keyword">if</span> reduction_override <span class="token keyword">else</span> self<span class="token punctuation">.</span>reduction<span class="token punctuation">)</span>\n        loss <span class="token operator">=</span> self<span class="token punctuation">.</span>loss_weight <span class="token operator">*</span> l1_loss<span class="token punctuation">(</span>\n            pred<span class="token punctuation">,</span> target<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> reduction<span class="token operator">=</span>reduction<span class="token punctuation">,</span> avg_factor<span class="token operator">=</span>avg_factor<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> loss\n</code></pre></div><div class="language-python"><pre><code><span class="token comment"># 记得去导入</span>\n<span class="token keyword">from</span> <span class="token punctuation">.</span>l1_loss <span class="token keyword">import</span> L1Loss<span class="token punctuation">,</span> l1_loss\n</code></pre></div><h4 id="新增预训练模型"><a class="header-anchor" href="#新增预训练模型" aria-hidden="true">#</a> 新增预训练模型</h4><p>去github网上下 找对应的 resnet18_8xb32</p><div class="language-python"><pre><code>log_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> hooks<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;TextLoggerHook&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\ndist_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">&#39;nccl&#39;</span><span class="token punctuation">)</span>\nlog_level <span class="token operator">=</span> <span class="token string">&#39;INFO&#39;</span>\nload_from <span class="token operator">=</span> \\mmcls\\data\\resnet18_8xb32_in1k_20210831<span class="token operator">-</span>fbbb1da6<span class="token punctuation">.</span>pth  <span class="token comment"># 这里</span>\nresume_from <span class="token operator">=</span> <span class="token boolean">None</span>\nworkflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;train&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\nwork_dir <span class="token operator">=</span> <span class="token string">&#39;./work_dirs/resnet18_8xb32_in1k&#39;</span>\ngpu_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\n</code></pre></div><h4 id="多加一个数据增强mixup"><a class="header-anchor" href="#多加一个数据增强mixup" aria-hidden="true">#</a> 多加一个数据增强mixup</h4><p>狗0.6 + 猫0.4</p><div class="language-python"><pre><code>model <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageClassifier&#39;</span><span class="token punctuation">,</span>\n    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ResNet&#39;</span><span class="token punctuation">,</span>\n        depth<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span>\n        num_stages<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>\n        out_indices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        style<span class="token operator">=</span><span class="token string">&#39;pytorch&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    neck<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;GlobalAveragePooling&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LinearClsHead&#39;</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">102</span><span class="token punctuation">,</span>\n        in_channels<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>\n        loss<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;L1Loss&#39;</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#L1Loss CrossEntropyLoss</span>\n        topk<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token comment"># 这里</span>\n    train_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>augments<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span> <span class="token string">&#39;BatchMixup&#39;</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.2</span>， num_classes<span class="token operator">=</span><span class="token number">102</span><span class="token punctuation">,</span> prob<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span>\n</code></pre></div><h3 id="_4-数据增强可视化模块"><a class="header-anchor" href="#_4-数据增强可视化模块" aria-hidden="true">#</a> 4. 数据增强可视化模块</h3><p>tools -&gt; visualizations</p><h4 id="中间结果-vis-pipeline-py"><a class="header-anchor" href="#中间结果-vis-pipeline-py" aria-hidden="true">#</a> 中间结果 vis_pipeline.py</h4><p>可以去看保存的文件 只弄了十张 查看输入和输出的数据</p><p>--phase train --number 10 --mode pipeline/transformed</p><div class="language-python"><pre><code><span class="token comment">#../../configs/resnet/today_resnet18_8xb32_in1k.py  --output-dir ../work_dirs/resnet18_8xb32_in1k/vis/vis_pipeline</span>\n<span class="token comment">#--phase train --number 10 --mode concat</span>\n</code></pre></div><h4 id="可视化模型效果-vim-cam-py"><a class="header-anchor" href="#可视化模型效果-vim-cam-py" aria-hidden="true">#</a> 可视化模型效果 vim_cam.py</h4><p>查看模型在训练的过程中主要关注的区域</p><div class="language-python"><pre><code><span class="token comment"># pip install &quot;grad-cam&gt;=1.3.6&quot;</span>\n\n<span class="token comment">#image_05094.jpg ../../configs/resnet/today_resnet18_8xb32_in1k.py ../work_dirs/resnet18_8xb32_in1k/epoch_100.pth</span>\n<span class="token comment">#--target-category</span>\n\n<span class="token comment">#cat-dog.png ../../configs/resnet/resnet18_8xb32_in1k.py D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmclassification-master\\\\mmcls\\\\data\\\\resnet18_8xb32_in1k_20210831-fbbb1da6.pth</span>\n<span class="token comment">#--target-category 238 --target-category 281</span>\n\n<span class="token comment">#backbone.layer1.1.conv1 backbone.layer2.1.conv1 backbone.layer1.1.conv1 backbone.layer4.1.conv2</span>\n<span class="token comment">#--target-layers backbone.layer2.1.conv2</span>\n</code></pre></div><h3 id="_5-模型分析脚本"><a class="header-anchor" href="#_5-模型分析脚本" aria-hidden="true">#</a> 5. 模型分析脚本</h3><p>tools -&gt; analysis_tools</p><h4 id="analyze-logs-py"><a class="header-anchor" href="#analyze-logs-py" aria-hidden="true">#</a> analyze_logs.py</h4><div class="language-python"><pre><code><span class="token comment">#plot_curve ../work_dirs/resnet18_8xb32_in1k/flower-100epoch.json --keys loss accuracy_top-1</span>\n\n<span class="token comment">#cal_train_time ../work_dirs/resnet18_8xb32_in1k/flower-100epoch.json</span>\n</code></pre></div><h4 id="get-flops-py-获取计算量"><a class="header-anchor" href="#get-flops-py-获取计算量" aria-hidden="true">#</a> get_flops.py 获取计算量</h4><div class="language-python"><pre><code><span class="token comment">#../../configs/resnet/today_resnet18_8xb32_in1k.py --shape 224 224</span>\n</code></pre></div><h2 id="_3-模块一：模型源码debug"><a class="header-anchor" href="#_3-模块一：模型源码debug" aria-hidden="true">#</a> 3. 模块一：模型源码debug</h2><h3 id="_1-vit任务概述"><a class="header-anchor" href="#_1-vit任务概述" aria-hidden="true">#</a> 1. VIT任务概述</h3><p>一般在哪打断点 在for_word()</p><h2 id="_4-模块二：使用分割模块训练自己的数据集"><a class="header-anchor" href="#_4-模块二：使用分割模块训练自己的数据集" aria-hidden="true">#</a> 4. 模块二：使用分割模块训练自己的数据集</h2><p>源码：mmsegementation</p><h3 id="_1-数据集标注"><a class="header-anchor" href="#_1-数据集标注" aria-hidden="true">#</a> 1. 数据集标注</h3><p>使用labelme 需要把文件夹整个复制过去</p><p>如果要用分割的话</p><div class="language-python"><pre><code>cell my_cell_voc <span class="token operator">-</span><span class="token operator">-</span>labels cell_labels<span class="token punctuation">.</span>txt\n</code></pre></div><div class="language-"><pre><code># cell_labels.txt  有多少个类别标注多少个\n__ignore__\n_background_\naeroplane\nbicycle\nbird\nboat\nbottle\nbus\n</code></pre></div><p>利用labelme 生成的 my_cell_voc 放到mmsegementation中</p><p>train.txt 是训练的文件名</p><p>test.txt</p><p>val.txt 是测试的文件名 这三个文件自己去写脚本</p><h3 id="_2-预测类别数修改配置文件"><a class="header-anchor" href="#_2-预测类别数修改配置文件" aria-hidden="true">#</a> 2. 预测类别数修改配置文件</h3><p>这个文件名<code>deeplabv3plus_r18-d8_512x1024_80k_cityscapes.py</code>来自于深度学习库MMsegmentation，它是一个用于语义分割的开源库。文件名包含了一些关于模型配置的重要信息。我们可以将其分解为以下几部分：</p><ol><li><p><strong>deeplabv3plus</strong>: 这是所使用的模型的名称。在这种情况下，它是DeepLabv3+，这是一种用于图像分割的深度学习模型。</p></li><li><p><strong>r18</strong>: 这是模型的骨干网络(backbone)。在这种情况下, <code>r18</code>代表ResNet-18，这是一种常用的卷积神经网络，通常用作深度学习模型的基础。</p></li><li><p><strong>d8</strong>: 这是模型的深度因子。在这种情况下，<code>d8</code>代表深度因子为8。这个参数通常影响模型的大小和计算复杂度。</p></li><li><p><strong>512x1024</strong>: 这是输入图像的大小。在这种情况下，模型接受512x1024像素的图像作为输入。</p></li><li><p><strong>80k</strong>: 这是训练步数。在这种情况下，模型在80,000步后停止训练。</p></li><li><p><strong>cityscapes</strong>: 这是所使用的数据集的名称。在这种情况下，它是Cityscapes数据集，这是一个用于语义理解的大规模数据集，包含了来自50个不同城市的街景图片。</p></li></ol><p>总的来说，这个文件名提供了关于模型配置和训练的一些重要信息。</p><p>最后这个预训练模型的，最好找相似的这样训练比较快</p><p>去 <a href="http://train.py" target="_blank" rel="noopener noreferrer">train.py</a> 找模型执行</p><div class="language-python"><pre><code><span class="token comment"># D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\configs\\\\deeplabv3plus\\\\deeplabv3plus_r18-d8_512x1024_80k_cityscapes.py</span>\n</code></pre></div><p>执行完后去tools -&gt; word_dirs找生成的模型 改成自己的名字my_deeplabv3plus_r50-d8_480x480_40k_pascal_context.py，然后去修改配置</p><div class="language-python"><pre><code><span class="token comment"># D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\configs\\\\deeplabv3plus\\\\my_deeplabv3plus_r50-d8_480x480_40k_pascal_context.py</span>\n</code></pre></div><p>my_deeplabv3plus_r50-d8_480x480_40k_pascal_context.py</p><div class="language-python"><pre><code>norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SyncBN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\nmodel <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;EncoderDecoder&#39;</span><span class="token punctuation">,</span>\n    pretrained<span class="token operator">=</span><span class="token string">&#39;open-mmlab://resnet50_v1c&#39;</span><span class="token punctuation">,</span>\n    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ResNetV1c&#39;</span><span class="token punctuation">,</span>\n        depth<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>\n        num_stages<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>\n        out_indices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        dilations<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        strides<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SyncBN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        norm_eval<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token comment">#BN的统计项不更新</span>\n        style<span class="token operator">=</span><span class="token string">&#39;pytorch&#39;</span><span class="token punctuation">,</span><span class="token comment">#3*3conv stride2</span>\n        contract_dilation<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    decode_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DepthwiseSeparableASPPHead&#39;</span><span class="token punctuation">,</span>\n        in_channels<span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">,</span>\n        in_index<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>\n        channels<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>\n        dilations<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        c1_in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>\n        c1_channels<span class="token operator">=</span><span class="token number">48</span><span class="token punctuation">,</span>\n        dropout_ratio<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment"># 自己的类别 默认有个背景 要记得+1</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SyncBN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        align_corners<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        loss_decode<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CrossEntropyLoss&#39;</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    auxiliary_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;FCNHead&#39;</span><span class="token punctuation">,</span>\n        in_channels<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span>\n        in_index<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>\n        channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>\n        num_convs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n        concat_input<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        dropout_ratio<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment"># 自己的类别 默认有个背景 要记得+1</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SyncBN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        align_corners<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        loss_decode<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CrossEntropyLoss&#39;</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    train_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    test_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>mode<span class="token operator">=</span><span class="token string">&#39;slide&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nimg_norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\nimg_scale <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">520</span><span class="token punctuation">,</span> <span class="token number">520</span><span class="token punctuation">)</span>\ncrop_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span>\ntrain_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadAnnotations&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">520</span><span class="token punctuation">,</span> <span class="token number">520</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ratio_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomCrop&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cat_max_ratio<span class="token operator">=</span><span class="token number">0.75</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> prob<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PhotoMetricDistortion&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pad_val<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> seg_pad_val<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DefaultFormatBundle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_semantic_seg&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\ntest_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n        img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">520</span><span class="token punctuation">,</span> <span class="token number">520</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\ndata <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    samples_per_gpu<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>\n    workers_per_gpu<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PascalVOCDataset&#39;</span><span class="token punctuation">,</span> <span class="token comment"># 不能改</span>\n        data_root<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\my_cell_voc&#39;</span><span class="token punctuation">,</span>\n        img_dir<span class="token operator">=</span><span class="token string">&#39;JPEGImages&#39;</span><span class="token punctuation">,</span> <span class="token comment"># 脚本生成的 不用改了</span>\n        ann_dir<span class="token operator">=</span><span class="token string">&#39;SegmentationClassPNG&#39;</span><span class="token punctuation">,</span>\n        split<span class="token operator">=</span><span class="token string">&#39;train.txt&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadAnnotations&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">520</span><span class="token punctuation">,</span> <span class="token number">520</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ratio_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomCrop&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cat_max_ratio<span class="token operator">=</span><span class="token number">0.75</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 预训练模型用的512的 应该也可以 </span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> prob<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PhotoMetricDistortion&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pad_val<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> seg_pad_val<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DefaultFormatBundle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_semantic_seg&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PascalVOCDataset&#39;</span><span class="token punctuation">,</span>\n        data_root<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\my_cell_voc&#39;</span><span class="token punctuation">,</span>\n        img_dir<span class="token operator">=</span><span class="token string">&#39;JPEGImages&#39;</span><span class="token punctuation">,</span>\n        ann_dir<span class="token operator">=</span><span class="token string">&#39;SegmentationClassPNG&#39;</span><span class="token punctuation">,</span>\n        split<span class="token operator">=</span><span class="token string">&#39;val.txt&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">520</span><span class="token punctuation">,</span> <span class="token number">520</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n                <span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PascalVOCDataset&#39;</span><span class="token punctuation">,</span>\n        data_root<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\my_cell_voc&#39;</span><span class="token punctuation">,</span>\n        img_dir<span class="token operator">=</span><span class="token string">&#39;JPEGImages&#39;</span><span class="token punctuation">,</span>\n        ann_dir<span class="token operator">=</span><span class="token string">&#39;SegmentationClassPNG&#39;</span><span class="token punctuation">,</span>\n        split<span class="token operator">=</span><span class="token string">&#39;test.txt&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">520</span><span class="token punctuation">,</span> <span class="token number">520</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n                <span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nlog_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    interval<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> hooks<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;TextLoggerHook&#39;</span><span class="token punctuation">,</span> by_epoch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 没迭代多少次打印信息，可以改小一点</span>\ndist_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">&#39;nccl&#39;</span><span class="token punctuation">)</span>\nlog_level <span class="token operator">=</span> <span class="token string">&#39;INFO&#39;</span>\nload_from <span class="token operator">=</span> <span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\tools\\\\work_dirs\\\\deeplabv3plus_r50-d8_480x480_40k_pascal_context\\\\deeplabv3plus_r50-d8_512x512_20k_voc12aug_20200617_102323-aad58ef1.pth&#39;</span> <span class="token comment"># 预训练模型</span>\nresume_from <span class="token operator">=</span> <span class="token boolean">None</span>\nworkflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;train&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\ncudnn_benchmark <span class="token operator">=</span> <span class="token boolean">True</span>\noptimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SGD&#39;</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.004</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>\noptimizer_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nlr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>policy<span class="token operator">=</span><span class="token string">&#39;poly&#39;</span><span class="token punctuation">,</span> power<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> min_lr<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">,</span> by_epoch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>\nrunner <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;IterBasedRunner&#39;</span><span class="token punctuation">,</span> max_iters<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>\ncheckpoint_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>by_epoch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> interval<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>\nevaluation <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">&#39;mIoU&#39;</span><span class="token punctuation">,</span> pre_eval<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 多少次迭代 走一次验证集的评估</span>\nwork_dir <span class="token operator">=</span> <span class="token string">&#39;./work_dirs\\deeplabv3plus_r50-d8_480x480_40k_pascal_context&#39;</span> <span class="token comment"># 模型训练后保存路径</span>\ngpu_ids <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>\n</code></pre></div><p>mmseg -&gt; datasets -&gt; <a href="http://voc.py" target="_blank" rel="noopener noreferrer">voc.py</a></p><div class="language-python"><pre><code><span class="token comment"># 一定要去改成对应的  background不要删</span>\nCLASSES <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;background&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;cell&#39;</span><span class="token punctuation">)</span>\nPALETTE <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\n</code></pre></div><p>mmseg -&gt; core -&gt; evaluation -&gt; class_names.py</p><div class="language-python"><pre><code><span class="token keyword">def</span> <span class="token function">voc_classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">&quot;&quot;&quot;Pascal VOC class names for external use.&quot;&quot;&quot;</span>\n    <span class="token triple-quoted-string string">&quot;&quot;&quot;\n    return [\n        &#39;background&#39;, &#39;aeroplane&#39;, &#39;bicycle&#39;, &#39;bird&#39;, &#39;boat&#39;, &#39;bottle&#39;, &#39;bus&#39;,\n        &#39;car&#39;, &#39;cat&#39;, &#39;chair&#39;, &#39;cow&#39;, &#39;diningtable&#39;, &#39;dog&#39;, &#39;horse&#39;,\n        &#39;motorbike&#39;, &#39;person&#39;, &#39;pottedplant&#39;, &#39;sheep&#39;, &#39;sofa&#39;, &#39;train&#39;,\n        &#39;tvmonitor&#39;\n    ]\n    &quot;&quot;&quot;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n        <span class="token string">&#39;background&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;cell&#39;</span>\n    <span class="token punctuation">]</span>\n</code></pre></div><h3 id="_3-开始训练"><a class="header-anchor" href="#_3-开始训练" aria-hidden="true">#</a> 3. 开始训练</h3><p>训练开始前 用小工具看标注是否正确</p><p>tools -&gt; browse_dataset.py</p><div class="language-python"><pre><code><span class="token comment"># D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\configs\\\\deeplabv3plus\\\\my_deeplabv3plus_r50-d8_480x480_40k_pascal_context.py</span>\n<span class="token comment">#--show</span>\n</code></pre></div><p>预训练模型在哪下</p><p><a href="https://github.com/open-mmlab/mmsegmentation/blob/main/docs/en/model_zoo.md" target="_blank" rel="noopener noreferrer">https://github.com/open-mmlab/mmsegmentation/blob/main/docs/en/model_zoo.md</a></p><p><a href="https://github.com/open-mmlab/mmsegmentation/tree/main/configs/deeplabv3plus" target="_blank" rel="noopener noreferrer">https://github.com/open-mmlab/mmsegmentation/tree/main/configs/deeplabv3plus</a></p><h3 id="_4-预测demo"><a class="header-anchor" href="#_4-预测demo" aria-hidden="true">#</a> 4. 预测demo</h3><p>demo -&gt; image_demo.py</p><div class="language-python"><pre><code><span class="token triple-quoted-string string">&quot;&quot;&quot;\nmy_cell.jpg\nD:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\configs\\\\deeplabv3plus\\\\my_deeplabv3plus_r50-d8_480x480_40k_pascal_context.py\nD:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\tools\\\\work_dirs\\\\deeplabv3plus_r50-d8_480x480_40k_pascal_context\\iter_1000.pth\n--palette voc\n&quot;&quot;&quot;</span>\n\n<span class="token triple-quoted-string string">&quot;&quot;&quot;\nmy_cell.jpg\nD:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\configs\\\\deeplabv3plus\\\\student_deeplabv3plus_r50-d8_480x480_40k_pascal_context.py\nD:\\\\eclipse-workspace\\\\PyTorch4\\mmrazor-master\\\\tools\\mmseg\\\\work_dirs\\\\cwd_cls_head_pspnet_r101_d8_pspnet_r18_d8_512x1024_cityscapes_80k\\\\deeplabv3+student+iter200.pth\n--palette voc\n&quot;&quot;&quot;</span>\n\n<span class="token comment">#T</span>\n<span class="token triple-quoted-string string">&quot;&quot;&quot;\nmy_cell.jpg\nD:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\configs\\\\deeplabv3plus\\\\my_deeplabv3plus_r50-d8_480x480_40k_pascal_context.py\nD:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\tools\\\\work_dirs\\\\deeplabv3plus_r50-d8_480x480_40k_pascal_context\\iter_1000.pth\n--palette voc\n&quot;&quot;&quot;</span>\n\n<span class="token comment">#S</span>\n<span class="token triple-quoted-string string">&quot;&quot;&quot;\nmy_cell.jpg\nD:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\configs\\\\deeplabv3plus\\\\student_deeplabv3plus_r50-d8_480x480_40k_pascal_context.py\nD:\\\\eclipse-workspace\\\\PyTorch4\\\\mmrazor-master\\\\tools\\\\mmseg\\\\work_dirs\\\\cwd_cls_head_pspnet_r101_d8_pspnet_r18_d8_512x1024_cityscapes_80k\\\\deeplabv3+student+iter200.pth\n--palette voc\n&quot;&quot;&quot;</span>\n</code></pre></div><h2 id="_5-模块二：基于unet进行各种策略修改"><a class="header-anchor" href="#_5-模块二：基于unet进行各种策略修改" aria-hidden="true">#</a> 5. 模块二：基于Unet进行各种策略修改</h2><h3 id="_1-配置文件解读"><a class="header-anchor" href="#_1-配置文件解读" aria-hidden="true">#</a> 1. 配置文件解读</h3><p>my_fcn_unet_s5-d16_64x64_40k_drive.py</p><div class="language-python"><pre><code>norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SyncBN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\nmodel <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;EncoderDecoder&#39;</span><span class="token punctuation">,</span> \n    pretrained<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;UNet&#39;</span><span class="token punctuation">,</span> <span class="token comment"># 打断点</span>\n        in_channels<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment"># 输入的颜色通道 一般不改</span>\n        base_channels<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>\n        num_stages<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> \n        strides<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        enc_num_convs<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        dec_num_convs<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        downsamples<span class="token operator">=</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        enc_dilations<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        dec_dilations<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        with_cp<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        conv_cfg<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SyncBN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        act_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ReLU&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        upsample_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;InterpConv&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        norm_eval<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    decode_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;FCNHead&#39;</span><span class="token punctuation">,</span> <span class="token comment"># 打断点</span>\n        in_channels<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token comment"># 输入的通道数</span>\n        in_index<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment"># debug 选最后一个</span>\n        channels<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>\n        num_convs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n        concat_input<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        dropout_ratio<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SyncBN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        align_corners<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        loss_decode<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CrossEntropyLoss&#39;</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    auxiliary_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;FCNHead&#39;</span><span class="token punctuation">,</span>\n        in_channels<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span>\n        in_index<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>\n        channels<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>\n        num_convs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n        concat_input<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        dropout_ratio<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SyncBN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        align_corners<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        loss_decode<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CrossEntropyLoss&#39;</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    train_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    test_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>mode<span class="token operator">=</span><span class="token string">&#39;slide&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\ndataset_type <span class="token operator">=</span> <span class="token string">&#39;PascalVOCDataset&#39;</span>\ndata_root <span class="token operator">=</span> <span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\VOC2012&#39;</span>\nimg_norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\nimg_scale <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">605</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span>\ncrop_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>\ntrain_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadAnnotations&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">605</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ratio_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomCrop&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cat_max_ratio<span class="token operator">=</span><span class="token number">0.75</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> prob<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PhotoMetricDistortion&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pad_val<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> seg_pad_val<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DefaultFormatBundle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_semantic_seg&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\ntest_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n        img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">605</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\ndata <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    samples_per_gpu<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n    workers_per_gpu<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RepeatDataset&#39;</span><span class="token punctuation">,</span>\n        times<span class="token operator">=</span><span class="token number">40000</span><span class="token punctuation">,</span>\n        dataset<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PascalVOCDataset&#39;</span><span class="token punctuation">,</span>\n            data_root<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\VOC2012&#39;</span><span class="token punctuation">,</span>\n            img_dir<span class="token operator">=</span><span class="token string">&#39;JPEGImages&#39;</span><span class="token punctuation">,</span>\n            ann_dir<span class="token operator">=</span><span class="token string">&#39;SegmentationClassPNG&#39;</span><span class="token punctuation">,</span>\n            split<span class="token operator">=</span><span class="token string">&#39;train.txt&#39;</span><span class="token punctuation">,</span>\n            pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadAnnotations&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span>\n                    img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">605</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    ratio_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomCrop&#39;</span><span class="token punctuation">,</span>\n                    crop_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    cat_max_ratio<span class="token operator">=</span><span class="token number">0.75</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> prob<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PhotoMetricDistortion&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                    std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                    to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pad_val<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> seg_pad_val<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DefaultFormatBundle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_semantic_seg&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PascalVOCDataset&#39;</span><span class="token punctuation">,</span>\n        data_root<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\VOC2012&#39;</span><span class="token punctuation">,</span>\n        img_dir<span class="token operator">=</span><span class="token string">&#39;JPEGImages&#39;</span><span class="token punctuation">,</span>\n        ann_dir<span class="token operator">=</span><span class="token string">&#39;SegmentationClassPNG&#39;</span><span class="token punctuation">,</span>\n        split<span class="token operator">=</span><span class="token string">&#39;val.txt&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">605</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n                <span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PascalVOCDataset&#39;</span><span class="token punctuation">,</span>\n        data_root<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\VOC2012&#39;</span><span class="token punctuation">,</span>\n        img_dir<span class="token operator">=</span><span class="token string">&#39;JPEGImages&#39;</span><span class="token punctuation">,</span>\n        ann_dir<span class="token operator">=</span><span class="token string">&#39;SegmentationClassPNG&#39;</span><span class="token punctuation">,</span>\n        split<span class="token operator">=</span><span class="token string">&#39;test.txt&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">605</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n                <span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nlog_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    interval<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> hooks<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;TextLoggerHook&#39;</span><span class="token punctuation">,</span> by_epoch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\ndist_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">&#39;nccl&#39;</span><span class="token punctuation">)</span>\nlog_level <span class="token operator">=</span> <span class="token string">&#39;INFO&#39;</span>\nload_from <span class="token operator">=</span> <span class="token boolean">None</span>\nresume_from <span class="token operator">=</span> <span class="token boolean">None</span>\nworkflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;train&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\ncudnn_benchmark <span class="token operator">=</span> <span class="token boolean">True</span>\noptimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SGD&#39;</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.0005</span><span class="token punctuation">)</span>\noptimizer_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nlr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>policy<span class="token operator">=</span><span class="token string">&#39;poly&#39;</span><span class="token punctuation">,</span> power<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> min_lr<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">,</span> by_epoch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>\nrunner <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;IterBasedRunner&#39;</span><span class="token punctuation">,</span> max_iters<span class="token operator">=</span><span class="token number">40000</span><span class="token punctuation">)</span>\ncheckpoint_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>by_epoch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> interval<span class="token operator">=</span><span class="token number">4000</span><span class="token punctuation">)</span>\nevaluation <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">4000</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">&#39;mDice&#39;</span><span class="token punctuation">,</span> pre_eval<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\nwork_dir <span class="token operator">=</span> <span class="token string">&#39;./work_dirs/fcn_unet_s5-d16_128x128_40k_stare&#39;</span>\ngpu_ids <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>\n</code></pre></div><h3 id="优化"><a class="header-anchor" href="#优化" aria-hidden="true">#</a> 优化</h3><div class="language-python"><pre><code>norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;BN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n\nmodel <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;EncoderDecoder&#39;</span><span class="token punctuation">,</span>\n    pretrained<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n    <span class="token comment">#pretrained=&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\fcn_unet_s5-d16_64x64_40k_drive_20201223_191051-5daf6d3b.pth&#39;,</span>\n    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;VisionTransformer&#39;</span><span class="token punctuation">,</span>\n        img_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        patch_size<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span>\n        in_channels<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>\n        embed_dims<span class="token operator">=</span><span class="token number">768</span><span class="token punctuation">,</span>\n        num_layers<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span>\n        num_heads<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span>\n        mlp_ratio<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>\n        out_indices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        qkv_bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n        drop_rate<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>\n        attn_drop_rate<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>\n        drop_path_rate<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>\n        with_cls_token<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LN&#39;</span><span class="token punctuation">,</span> eps<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        act_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;GELU&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        norm_eval<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        interpolate_mode<span class="token operator">=</span><span class="token string">&#39;bicubic&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    neck<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;FPN&#39;</span><span class="token punctuation">,</span>\n            in_channels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">768</span><span class="token punctuation">,</span> <span class="token number">768</span><span class="token punctuation">,</span> <span class="token number">768</span><span class="token punctuation">,</span> <span class="token number">768</span><span class="token punctuation">,</span> <span class="token number">768</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            out_channels<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>\n            num_outs<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    decode_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;FCNHead&#39;</span><span class="token punctuation">,</span>\n        in_channels<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>\n        in_index<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>\n        channels<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>\n        num_convs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n        concat_input<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        dropout_ratio<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;BN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        align_corners<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        loss_decode<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;FocalLoss&#39;</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#CrossEntropyLoss</span>\n    auxiliary_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;FCNHead&#39;</span><span class="token punctuation">,</span><span class="token comment">#deep-supervised，可以参考https://github.com/open-mmlab/mmsegmentation/issues/503</span>\n        in_channels<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>\n        in_index<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>\n        channels<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>\n        num_convs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n        concat_input<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        dropout_ratio<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">#mmsegmentation/mmseg/datasets里修改voc.py，对应好类别和颜色;mmsegmentation/mmseg/core/evaluation里修改class_names.py</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;BN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        align_corners<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        loss_decode<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;FocalLoss&#39;</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    train_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    test_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>mode<span class="token operator">=</span><span class="token string">&#39;slide&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\ndataset_type <span class="token operator">=</span> <span class="token string">&#39;PascalVOCDataset&#39;</span>\ndata_root <span class="token operator">=</span> <span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\my_cell&#39;</span>\nimg_norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\nimg_scale <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">584</span><span class="token punctuation">,</span> <span class="token number">565</span><span class="token punctuation">)</span>\ncrop_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span>\ntrain_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadAnnotations&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">584</span><span class="token punctuation">,</span> <span class="token number">565</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ratio_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomCrop&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cat_max_ratio<span class="token operator">=</span><span class="token number">0.75</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> prob<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PhotoMetricDistortion&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pad_val<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> seg_pad_val<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DefaultFormatBundle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_semantic_seg&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\ntest_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n        img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">584</span><span class="token punctuation">,</span> <span class="token number">565</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\ndata <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    samples_per_gpu<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>\n    workers_per_gpu<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RepeatDataset&#39;</span><span class="token punctuation">,</span>\n        times<span class="token operator">=</span><span class="token number">40000</span><span class="token punctuation">,</span>\n        dataset<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PascalVOCDataset&#39;</span><span class="token punctuation">,</span>\n            data_root<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\my_cell&#39;</span><span class="token punctuation">,</span>\n            img_dir<span class="token operator">=</span><span class="token string">&#39;JPEGImages&#39;</span><span class="token punctuation">,</span>\n            ann_dir<span class="token operator">=</span><span class="token string">&#39;SegmentationClassPNG&#39;</span><span class="token punctuation">,</span>\n            split<span class="token operator">=</span><span class="token string">&#39;train.txt&#39;</span><span class="token punctuation">,</span>\n            pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadAnnotations&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span>\n                    img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">584</span><span class="token punctuation">,</span> <span class="token number">565</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    ratio_range<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomCrop&#39;</span><span class="token punctuation">,</span> crop_size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cat_max_ratio<span class="token operator">=</span><span class="token number">0.75</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> prob<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PhotoMetricDistortion&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                    std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                    to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pad_val<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> seg_pad_val<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DefaultFormatBundle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_semantic_seg&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PascalVOCDataset&#39;</span><span class="token punctuation">,</span>\n        data_root<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\my_cell&#39;</span><span class="token punctuation">,</span>\n        img_dir<span class="token operator">=</span><span class="token string">&#39;JPEGImages&#39;</span><span class="token punctuation">,</span>\n        ann_dir<span class="token operator">=</span><span class="token string">&#39;SegmentationClassPNG&#39;</span><span class="token punctuation">,</span>\n        split<span class="token operator">=</span><span class="token string">&#39;val.txt&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">584</span><span class="token punctuation">,</span> <span class="token number">565</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n                <span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;PascalVOCDataset&#39;</span><span class="token punctuation">,</span>\n        data_root<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmsegmentation-0.20.2\\\\data\\\\my_cell&#39;</span><span class="token punctuation">,</span>\n        img_dir<span class="token operator">=</span><span class="token string">&#39;JPEGImages&#39;</span><span class="token punctuation">,</span>\n        ann_dir<span class="token operator">=</span><span class="token string">&#39;SegmentationClassPNG&#39;</span><span class="token punctuation">,</span>\n        split<span class="token operator">=</span><span class="token string">&#39;test.txt&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">584</span><span class="token punctuation">,</span> <span class="token number">565</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n                <span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nlog_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    interval<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> hooks<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;TextLoggerHook&#39;</span><span class="token punctuation">,</span> by_epoch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\ndist_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">&#39;nccl&#39;</span><span class="token punctuation">)</span>\nlog_level <span class="token operator">=</span> <span class="token string">&#39;INFO&#39;</span>\nload_from <span class="token operator">=</span> <span class="token boolean">None</span>\nresume_from <span class="token operator">=</span> <span class="token boolean">None</span>\nworkflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;train&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\ncudnn_benchmark <span class="token operator">=</span> <span class="token boolean">True</span>\n<span class="token comment">#optimizer = dict(type=&#39;SGD&#39;, lr=0.01, momentum=0.9, weight_decay=0.0005)</span>\noptimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Adam&#39;</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.0005</span><span class="token punctuation">)</span>\noptimizer_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nlr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>policy<span class="token operator">=</span><span class="token string">&#39;poly&#39;</span><span class="token punctuation">,</span> power<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> min_lr<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">,</span> by_epoch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>\nrunner <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;IterBasedRunner&#39;</span><span class="token punctuation">,</span> max_iters<span class="token operator">=</span><span class="token number">40000</span><span class="token punctuation">)</span>\ncheckpoint_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>by_epoch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> interval<span class="token operator">=</span><span class="token number">40000</span><span class="token punctuation">)</span>\nevaluation <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">&#39;mIoU&#39;</span><span class="token punctuation">,</span> pre_eval<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\nwork_dir <span class="token operator">=</span> <span class="token string">&#39;./work_dirs/my_fcn_unet_s5-d16_64x64_40k_drive-cell&#39;</span>\ngpu_ids <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>\n\n</code></pre></div><h2 id="_6-第二模块：（论文）分割任务cvpr最新backbone设计及其应用"><a class="header-anchor" href="#_6-第二模块：（论文）分割任务cvpr最新backbone设计及其应用" aria-hidden="true">#</a> 6. 第二模块：（论文）分割任务CVPR最新Backbone设计及其应用</h2><p>参考论文：MPViT : Multi-Path Vision Transformer for Dense Prediction</p><p>对vit模型进行创新</p><p><strong>Backbone</strong>：在机器学习和计算机视觉中，Backbone通常指的是神经网络的主要部分，也通常被称为基础网络。Backbone网络负责提取输入数据（例如图像）中的特征，这些特征会被送到网络的下一部分用于更具体的任务，例如物体探测或语义分割。</p><h3 id="_1-注册自己的backbone"><a class="header-anchor" href="#_1-注册自己的backbone" aria-hidden="true">#</a> 1. 注册自己的Backbone</h3><p><strong>MPViT</strong> 是 &quot;Multi-scale Pyramid Vision Transformer&quot; 的缩写，这是一种基于 Vision Transformer (ViT) 的新型网络结构。ViT 是一种将 Transformer 应用于视觉任务的网络结构，它将输入图像划分为一系列的小块，然后使用 Transformer 对这些小块进行处理。MPViT 则在此基础上进行了改进，它使用了多尺度的策略，可以在不同的尺度上提取图像特征，这有助于捕捉到更丰富的图像信息。</p><p>具体来说，MPViT 通过在不同的空间分辨率上应用 Transformer，可以有效地处理不同尺度的视觉信息。这种设计使得 MPViT 在一些视觉任务，例如图像分割，上表现出了优秀的性能。</p><p>&quot;<a href="http://mpvit.py" target="_blank" rel="noopener noreferrer">mpvit.py</a>&quot; 文件中的代码就是实现了这种 MPViT 结构。在进行图像分割任务时，可以使用这个文件中的 MPViT 网络作为 Backbone，以提取输入图像的特征。</p><p>upernet_mpvit_small_160k_ade20k.py</p><div class="language-python"><pre><code>_base_ <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token string">&#39;../../_base_/models/upernet_mpvit.py&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;../../_base_/datasets/ade20k.py&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;../../_base_/default_runtime.py&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;../../_base_/schedules/schedule_160k.py&#39;</span>\n<span class="token punctuation">]</span>\nmodel <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    pretrained<span class="token operator">=</span><span class="token string">r&#39;https://dl.dropbox.com/s/1o07eti5rgve1i6/mpvit_small_mm.pth&#39;</span><span class="token punctuation">,</span>\n    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MPViT&#39;</span><span class="token punctuation">,</span>\n        num_path<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        num_layers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        embed_dims<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">216</span><span class="token punctuation">,</span> <span class="token number">288</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        drop_path_rate<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SyncBN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        norm_eval<span class="token operator">=</span><span class="token boolean">False</span>\n    <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    decode_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        in_channels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">216</span><span class="token punctuation">,</span> <span class="token number">288</span><span class="token punctuation">,</span> <span class="token number">288</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    auxiliary_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        in_channels<span class="token operator">=</span><span class="token number">288</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">150</span>\n    <span class="token punctuation">)</span><span class="token punctuation">)</span>\n\noptimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>_delete_<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;AdamW&#39;</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.00006</span><span class="token punctuation">,</span> betas<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.999</span><span class="token punctuation">)</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>\n\nlr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>_delete_<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> policy<span class="token operator">=</span><span class="token string">&#39;poly&#39;</span><span class="token punctuation">,</span>\n                 warmup<span class="token operator">=</span><span class="token string">&#39;linear&#39;</span><span class="token punctuation">,</span>\n                 warmup_iters<span class="token operator">=</span><span class="token number">1500</span><span class="token punctuation">,</span>\n                 warmup_ratio<span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span>\n                 power<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> min_lr<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> by_epoch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>\n\n<span class="token comment"># By default, models are trained on 8 GPUs with 2 images per GPU</span>\ndata<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>samples_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>\nwork_dir <span class="token operator">=</span> <span class="token string">&#39;./work_dirs/mpvit_small&#39;</span>\n</code></pre></div><h3 id="_2-配置文件指定"><a class="header-anchor" href="#_2-配置文件指定" aria-hidden="true">#</a> 2. 配置文件指定</h3><p>04_MMLAB\\MPViT-main\\semantic_segmentation\\mmseg\\models\\segmentors\\encoder_decoder.py</p><p>encoder_decoder在这里面去打断点 139行 602行 711 715</p><p>mpvit 里面打断点 77 170 233</p><p>入口函数 <a href="http://train.py" target="_blank" rel="noopener noreferrer">train.py</a></p><div class="language-python"><pre><code><span class="token comment"># D:\\\\eclipse-workspace\\\\PyTorch4\\\\MPViT-main\\\\semantic_segmentation\\\\configs\\\\mpvit\\\\upernet\\\\upernet_mpvit_small_160k_ade20k.py</span>\n</code></pre></div><h3 id="_3-debug解读backbone"><a class="header-anchor" href="#_3-debug解读backbone" aria-hidden="true">#</a> 3. debug解读backbone</h3><h3 id="_4-patchembedding作用和实现"><a class="header-anchor" href="#_4-patchembedding作用和实现" aria-hidden="true">#</a> 4. patchembedding作用和实现</h3><div class="language-python"><pre><code>  <span class="token comment"># mpvit</span>\n    <span class="token keyword">def</span> <span class="token function">forward_features</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n        <span class="token comment"># x&#39;s shape : [B, C, H, W]</span>\n        outs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        x <span class="token operator">=</span> self<span class="token punctuation">.</span>stem<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment"># Shape : [B, C, H/4, W/4]</span>\n\n        <span class="token keyword">for</span> idx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_stages<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            att_inputs <span class="token operator">=</span> self<span class="token punctuation">.</span>patch_embed_stages<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment"># 这里</span>\n            x <span class="token operator">=</span> self<span class="token punctuation">.</span>mhca_stages<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">(</span>att_inputs<span class="token punctuation">)</span>\n\n            outs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n\n        <span class="token keyword">return</span> outs\n</code></pre></div><p>pe 就是patchembedding的缩写</p><p>保证transfomer输入是一样的</p><h3 id="_5-卷积位置编码计算方法"><a class="header-anchor" href="#_5-卷积位置编码计算方法" aria-hidden="true">#</a> 5. 卷积位置编码计算方法</h3><p>cpe卷积位置编码</p><div class="language-python"><pre><code>   <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        B<span class="token punctuation">,</span> N<span class="token punctuation">,</span> C <span class="token operator">=</span> x<span class="token punctuation">.</span>shape\n        H<span class="token punctuation">,</span> W <span class="token operator">=</span> size\n\n        feat <span class="token operator">=</span> x<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>B<span class="token punctuation">,</span> C<span class="token punctuation">,</span> H<span class="token punctuation">,</span> W<span class="token punctuation">)</span>\n        x <span class="token operator">=</span> self<span class="token punctuation">.</span>proj<span class="token punctuation">(</span>feat<span class="token punctuation">)</span> <span class="token operator">+</span> feat\n        x <span class="token operator">=</span> x<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n        <span class="token keyword">return</span> x\n</code></pre></div><p>mpvit 429</p><p>解决了变长的事情</p><h3 id="_6-近似attention实现"><a class="header-anchor" href="#_6-近似attention实现" aria-hidden="true">#</a> 6. 近似attention实现</h3><div class="language-python"><pre><code><span class="token keyword">class</span> <span class="token class-name">FactorAtt_ConvRelPosEnc</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">&quot;&quot;&quot;Factorized attention with convolutional relative position encoding class.&quot;&quot;&quot;</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>\n        self<span class="token punctuation">,</span>\n        dim<span class="token punctuation">,</span>\n        num_heads<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>\n        qkv_bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        qk_scale<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n        attn_drop<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>\n        proj_drop<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>\n        shared_crpe<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>num_heads <span class="token operator">=</span> num_heads\n        head_dim <span class="token operator">=</span> dim <span class="token operator">//</span> num_heads\n        self<span class="token punctuation">.</span>scale <span class="token operator">=</span> qk_scale <span class="token keyword">or</span> head_dim <span class="token operator">**</span> <span class="token operator">-</span><span class="token number">0.5</span>\n\n        self<span class="token punctuation">.</span>qkv <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>dim<span class="token punctuation">,</span> dim <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> bias<span class="token operator">=</span>qkv_bias<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>attn_drop <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>attn_drop<span class="token punctuation">)</span>  <span class="token comment"># Note: attn_drop is actually not used.</span>\n        self<span class="token punctuation">.</span>proj <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>dim<span class="token punctuation">,</span> dim<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>proj_drop <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>proj_drop<span class="token punctuation">)</span>\n\n        <span class="token comment"># Shared convolutional relative position encoding.</span>\n        self<span class="token punctuation">.</span>crpe <span class="token operator">=</span> shared_crpe\n\n    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        B<span class="token punctuation">,</span> N<span class="token punctuation">,</span> C <span class="token operator">=</span> x<span class="token punctuation">.</span>shape\n\n        <span class="token comment"># Generate Q, K, V.</span>\n        qkv <span class="token operator">=</span> <span class="token punctuation">(</span>\n            self<span class="token punctuation">.</span>qkv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n            <span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>B<span class="token punctuation">,</span> N<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_heads<span class="token punctuation">,</span> C <span class="token operator">//</span> self<span class="token punctuation">.</span>num_heads<span class="token punctuation">)</span>\n            <span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">)</span>  <span class="token comment"># Shape: [3, B, h, N, Ch].</span>\n        q<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v <span class="token operator">=</span> qkv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> qkv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> qkv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># Shape: [B, h, N, Ch].</span>\n\n        <span class="token comment"># Factorized attention.</span>\n        k_softmax <span class="token operator">=</span> k<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># Softmax on dim N.</span>\n        k_softmax_T_dot_v <span class="token operator">=</span> einsum<span class="token punctuation">(</span>\n            <span class="token string">&quot;b h n k, b h n v -&gt; b h k v&quot;</span><span class="token punctuation">,</span> k_softmax<span class="token punctuation">,</span> v\n        <span class="token punctuation">)</span>  <span class="token comment"># Shape: [B, h, Ch, Ch].</span>\n        factor_att <span class="token operator">=</span> einsum<span class="token punctuation">(</span>\n            <span class="token string">&quot;b h n k, b h k v -&gt; b h n v&quot;</span><span class="token punctuation">,</span> q<span class="token punctuation">,</span> k_softmax_T_dot_v\n        <span class="token punctuation">)</span>  <span class="token comment"># Shape: [B, h, N, Ch].</span>\n\n        <span class="token comment"># Convolutional relative position encoding.</span>\n        crpe <span class="token operator">=</span> self<span class="token punctuation">.</span>crpe<span class="token punctuation">(</span>q<span class="token punctuation">,</span> v<span class="token punctuation">,</span> size<span class="token operator">=</span>size<span class="token punctuation">)</span>  <span class="token comment"># Shape: [B, h, N, Ch].</span>\n\n        <span class="token comment"># Merge and reshape.</span>\n        x <span class="token operator">=</span> self<span class="token punctuation">.</span>scale <span class="token operator">*</span> factor_att <span class="token operator">+</span> crpe\n        x <span class="token operator">=</span> <span class="token punctuation">(</span>\n            x<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>B<span class="token punctuation">,</span> N<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">)</span>  <span class="token comment"># Shape: [B, h, N, Ch] -&gt; [B, N, h, Ch] -&gt; [B, N, C].</span>\n\n        <span class="token comment"># Output projection.</span>\n        x <span class="token operator">=</span> self<span class="token punctuation">.</span>proj<span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n        x <span class="token operator">=</span> self<span class="token punctuation">.</span>proj_drop<span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n\n        <span class="token keyword">return</span> x\n</code></pre></div><h3 id="_7-完成特征提取与融合模块"><a class="header-anchor" href="#_7-完成特征提取与融合模块" aria-hidden="true">#</a> 7. 完成特征提取与融合模块</h3><div class="language-python"><pre><code><span class="token keyword">class</span> <span class="token class-name">MHCA_stage</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>\n        self<span class="token punctuation">,</span>\n        embed_dim<span class="token punctuation">,</span>\n        out_embed_dim<span class="token punctuation">,</span>\n        num_layers<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n        num_heads<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>\n        mlp_ratio<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>\n        num_path<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;BN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        drop_path_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n        self<span class="token punctuation">.</span>mhca_blks <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span>\n            <span class="token punctuation">[</span>\n                MHCAEncoder<span class="token punctuation">(</span>\n                    embed_dim<span class="token punctuation">,</span>\n                    num_layers<span class="token punctuation">,</span>\n                    num_heads<span class="token punctuation">,</span>\n                    mlp_ratio<span class="token punctuation">,</span>\n                    drop_path_list<span class="token operator">=</span>drop_path_list<span class="token punctuation">,</span>\n                <span class="token punctuation">)</span>\n                <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_path<span class="token punctuation">)</span>\n            <span class="token punctuation">]</span>\n        <span class="token punctuation">)</span>\n\n        self<span class="token punctuation">.</span>InvRes <span class="token operator">=</span> ResBlock<span class="token punctuation">(</span>\n            in_features<span class="token operator">=</span>embed_dim<span class="token punctuation">,</span> out_features<span class="token operator">=</span>embed_dim<span class="token punctuation">,</span> norm_cfg<span class="token operator">=</span>norm_cfg\n        <span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>aggregate <span class="token operator">=</span> Conv2d_BN<span class="token punctuation">(</span>\n            embed_dim <span class="token operator">*</span> <span class="token punctuation">(</span>num_path <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            out_embed_dim<span class="token punctuation">,</span>\n            act_layer<span class="token operator">=</span>nn<span class="token punctuation">.</span>Hardswish<span class="token punctuation">,</span>\n            norm_cfg<span class="token operator">=</span>norm_cfg<span class="token punctuation">,</span>\n        <span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        att_outputs <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>InvRes<span class="token punctuation">(</span>inputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n        <span class="token keyword">for</span> x<span class="token punctuation">,</span> encoder <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>inputs<span class="token punctuation">,</span> self<span class="token punctuation">.</span>mhca_blks<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token comment"># [B, C, H, W] -&gt; [B, N, C]</span>\n            _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> H<span class="token punctuation">,</span> W <span class="token operator">=</span> x<span class="token punctuation">.</span>shape\n            x <span class="token operator">=</span> x<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span>\n            att_outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>encoder<span class="token punctuation">(</span>x<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span>H<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n        out_concat <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>att_outputs<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>\n        out <span class="token operator">=</span> self<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>out_concat<span class="token punctuation">)</span>\n\n        <span class="token keyword">return</span> out\n</code></pre></div><h3 id="_8-分割任务输出模块"><a class="header-anchor" href="#_8-分割任务输出模块" aria-hidden="true">#</a> 8. 分割任务输出模块</h3><p>decode_head文件夹 用的uper_head.py</p><p>论文：Unified Perceptual Parsing for Scene Understanding</p><h3 id="_9-全局特征的作用和实现"><a class="header-anchor" href="#_9-全局特征的作用和实现" aria-hidden="true">#</a> 9. 全局特征的作用和实现</h3><p>psp_head.py</p><p>论文：Pyramid Scene Parsing Network</p><h2 id="_7-第三模块：mmdet训练自己的数据任务"><a class="header-anchor" href="#_7-第三模块：mmdet训练自己的数据任务" aria-hidden="true">#</a> 7. 第三模块：mmdet训练自己的数据任务</h2><h3 id="_1-数据集标注-1"><a class="header-anchor" href="#_1-数据集标注-1" aria-hidden="true">#</a> 1.数据集标注</h3><p>mmdetection-master 检测任务</p><p>deformale_detr 可变形的dtr 玩这个</p><h3 id="_2-coco数据标注格式"><a class="header-anchor" href="#_2-coco数据标注格式" aria-hidden="true">#</a> 2. coco数据标注格式</h3><p>04_MMLAB\\mmdetection-master\\mmdet\\data\\<a href="http://json2coco.py" target="_blank" rel="noopener noreferrer">json2coco.py</a></p><div class="language-python"><pre><code><span class="token keyword">import</span> os\n<span class="token keyword">import</span> json\n<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np\n<span class="token keyword">import</span> glob\n<span class="token keyword">import</span> shutil\n<span class="token keyword">import</span> cv2\n<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split\n\nnp<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">)</span>\n\nclassname_to_id <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">&quot;mask&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">#改成自己的类别</span>\n    <span class="token string">&quot;person&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span>\n<span class="token punctuation">}</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">Lableme2CoCo</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        self<span class="token punctuation">.</span>annotations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        self<span class="token punctuation">.</span>categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        self<span class="token punctuation">.</span>img_id <span class="token operator">=</span> <span class="token number">0</span>\n        self<span class="token punctuation">.</span>ann_id <span class="token operator">=</span> <span class="token number">0</span>\n\n    <span class="token keyword">def</span> <span class="token function">save_coco_json</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> save_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># indent=2 更加美观显示</span>\n\n    <span class="token comment"># 由json文件构建COCO</span>\n    <span class="token keyword">def</span> <span class="token function">to_coco</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> json_path_list<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>_init_categories<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">for</span> json_path <span class="token keyword">in</span> json_path_list<span class="token punctuation">:</span>\n            obj <span class="token operator">=</span> self<span class="token punctuation">.</span>read_jsonfile<span class="token punctuation">(</span>json_path<span class="token punctuation">)</span>\n            self<span class="token punctuation">.</span>images<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_image<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> json_path<span class="token punctuation">)</span><span class="token punctuation">)</span>\n            shapes <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token string">&#39;shapes&#39;</span><span class="token punctuation">]</span>\n            <span class="token keyword">for</span> shape <span class="token keyword">in</span> shapes<span class="token punctuation">:</span>\n                annotation <span class="token operator">=</span> self<span class="token punctuation">.</span>_annotation<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>\n                self<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>append<span class="token punctuation">(</span>annotation<span class="token punctuation">)</span>\n                self<span class="token punctuation">.</span>ann_id <span class="token operator">+=</span> <span class="token number">1</span>\n            self<span class="token punctuation">.</span>img_id <span class="token operator">+=</span> <span class="token number">1</span>\n        instance <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        instance<span class="token punctuation">[</span><span class="token string">&#39;info&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;spytensor created&#39;</span>\n        instance<span class="token punctuation">[</span><span class="token string">&#39;license&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;license&#39;</span><span class="token punctuation">]</span>\n        instance<span class="token punctuation">[</span><span class="token string">&#39;images&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>images\n        instance<span class="token punctuation">[</span><span class="token string">&#39;annotations&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>annotations\n        instance<span class="token punctuation">[</span><span class="token string">&#39;categories&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>categories\n        <span class="token keyword">return</span> instance\n\n    <span class="token comment"># 构建类别</span>\n    <span class="token keyword">def</span> <span class="token function">_init_categories</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> classname_to_id<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            category <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n            category<span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> v\n            category<span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> k\n            self<span class="token punctuation">.</span>categories<span class="token punctuation">.</span>append<span class="token punctuation">(</span>category<span class="token punctuation">)</span>\n\n    <span class="token comment"># 构建COCO的image字段</span>\n    <span class="token keyword">def</span> <span class="token function">_image</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        image <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token keyword">from</span> labelme <span class="token keyword">import</span> utils\n        img_x <span class="token operator">=</span> utils<span class="token punctuation">.</span>img_b64_to_arr<span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">&#39;imageData&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        h<span class="token punctuation">,</span> w <span class="token operator">=</span> img_x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\n        image<span class="token punctuation">[</span><span class="token string">&#39;height&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> h\n        image<span class="token punctuation">[</span><span class="token string">&#39;width&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> w\n        image<span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>img_id\n        image<span class="token punctuation">[</span><span class="token string">&#39;file_name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> image\n\n    <span class="token comment"># 构建COCO的annotation字段</span>\n    <span class="token keyword">def</span> <span class="token function">_annotation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> shape<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token comment"># print(&#39;shape&#39;, shape)</span>\n        label <span class="token operator">=</span> shape<span class="token punctuation">[</span><span class="token string">&#39;label&#39;</span><span class="token punctuation">]</span>\n        points <span class="token operator">=</span> shape<span class="token punctuation">[</span><span class="token string">&#39;points&#39;</span><span class="token punctuation">]</span>\n        annotation <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        annotation<span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>ann_id\n        annotation<span class="token punctuation">[</span><span class="token string">&#39;image_id&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>img_id\n        annotation<span class="token punctuation">[</span><span class="token string">&#39;category_id&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>classname_to_id<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">)</span>\n        annotation<span class="token punctuation">[</span><span class="token string">&#39;segmentation&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n        annotation<span class="token punctuation">[</span><span class="token string">&#39;bbox&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_box<span class="token punctuation">(</span>points<span class="token punctuation">)</span>\n        annotation<span class="token punctuation">[</span><span class="token string">&#39;iscrowd&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>\n        annotation<span class="token punctuation">[</span><span class="token string">&#39;area&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span>\n        <span class="token keyword">return</span> annotation\n\n    <span class="token comment"># 读取json文件，返回一个json对象</span>\n    <span class="token keyword">def</span> <span class="token function">read_jsonfile</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n            <span class="token keyword">return</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>\n\n    <span class="token comment"># COCO的格式： [x1,y1,w,h] 对应COCO的bbox格式</span>\n    <span class="token keyword">def</span> <span class="token function">_get_box</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        min_x <span class="token operator">=</span> min_y <span class="token operator">=</span> np<span class="token punctuation">.</span>inf\n        max_x <span class="token operator">=</span> max_y <span class="token operator">=</span> <span class="token number">0</span>\n        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> points<span class="token punctuation">:</span>\n            min_x <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>min_x<span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n            min_y <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>min_y<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n            max_x <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>max_x<span class="token punctuation">,</span> x<span class="token punctuation">)</span>\n            max_y <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>max_y<span class="token punctuation">,</span> y<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token punctuation">[</span>min_x<span class="token punctuation">,</span> min_y<span class="token punctuation">,</span> max_x <span class="token operator">-</span> min_x<span class="token punctuation">,</span> max_y <span class="token operator">-</span> min_y<span class="token punctuation">]</span>\n\n<span class="token comment">#训练过程中，如果遇到Index put requires the source and destination dtypes match, got Long for the destination and Int for the source</span>\n<span class="token comment">#参考：https://github.com/open-mmlab/mmdetection/issues/6706</span>\n<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span>\n    labelme_path <span class="token operator">=</span> <span class="token string">&quot;./labelme-data/maskdataset&quot;</span>\n    saved_coco_path <span class="token operator">=</span> <span class="token string">&quot;./labelme-data/coco-format&quot;</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;reading...&#39;</span><span class="token punctuation">)</span>\n    <span class="token comment"># 创建文件</span>\n    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">&quot;%scoco/annotations/&quot;</span> <span class="token operator">%</span> saved_coco_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">&quot;%scoco/annotations/&quot;</span> <span class="token operator">%</span> saved_coco_path<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">&quot;%scoco/images/train2017/&quot;</span> <span class="token operator">%</span> saved_coco_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">&quot;%scoco/images/train2017&quot;</span> <span class="token operator">%</span> saved_coco_path<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">&quot;%scoco/images/val2017/&quot;</span> <span class="token operator">%</span> saved_coco_path<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">&quot;%scoco/images/val2017&quot;</span> <span class="token operator">%</span> saved_coco_path<span class="token punctuation">)</span>\n    <span class="token comment"># 获取images目录下所有的joson文件列表</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>labelme_path <span class="token operator">+</span> <span class="token string">&quot;/*.json&quot;</span><span class="token punctuation">)</span>\n    json_list_path <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span>labelme_path <span class="token operator">+</span> <span class="token string">&quot;/*.json&quot;</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;json_list_path: &#39;</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>json_list_path<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token comment"># 数据划分,这里没有区分val2017和tran2017目录，所有图片都放在images目录下</span>\n    train_path<span class="token punctuation">,</span> val_path <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>json_list_path<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> train_size<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;train_n:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_path<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;val_n:&#39;</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>val_path<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># 把训练集转化为COCO的json格式</span>\n    l2c_train <span class="token operator">=</span> Lableme2CoCo<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    train_instance <span class="token operator">=</span> l2c_train<span class="token punctuation">.</span>to_coco<span class="token punctuation">(</span>train_path<span class="token punctuation">)</span>\n    l2c_train<span class="token punctuation">.</span>save_coco_json<span class="token punctuation">(</span>train_instance<span class="token punctuation">,</span> <span class="token string">&#39;%scoco/annotations/instances_train2017.json&#39;</span> <span class="token operator">%</span> saved_coco_path<span class="token punctuation">)</span>\n    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> train_path<span class="token punctuation">:</span>\n        <span class="token comment"># shutil.copy(file.replace(&quot;json&quot;, &quot;jpg&quot;), &quot;%scoco/images/train2017/&quot; % saved_coco_path)</span>\n        img_name <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&#39;json&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jpg&#39;</span><span class="token punctuation">)</span>\n        temp_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>img_name<span class="token punctuation">)</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">&quot;{}coco/images/train2017/{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>saved_coco_path<span class="token punctuation">,</span> img_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#39;\\\\&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&#39;png&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jpg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> temp_img<span class="token punctuation">)</span>\n        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Wrong Image:&#39;</span><span class="token punctuation">,</span> img_name <span class="token punctuation">)</span>\n            <span class="token keyword">continue</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>img_name <span class="token operator">+</span> <span class="token string">&#39;--&gt;&#39;</span><span class="token punctuation">,</span> img_name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&#39;png&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jpg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> val_path<span class="token punctuation">:</span>\n        <span class="token comment"># shutil.copy(file.replace(&quot;json&quot;, &quot;jpg&quot;), &quot;%scoco/images/val2017/&quot; % saved_coco_path)</span>\n        img_name <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&#39;json&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jpg&#39;</span><span class="token punctuation">)</span>\n        temp_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>img_name<span class="token punctuation">)</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">&quot;{}coco/images/val2017/{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>saved_coco_path<span class="token punctuation">,</span> img_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#39;\\\\&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&#39;png&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jpg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> temp_img<span class="token punctuation">)</span>\n        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;Wrong Image:&#39;</span><span class="token punctuation">,</span> img_name<span class="token punctuation">)</span>\n            <span class="token keyword">continue</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>img_name <span class="token operator">+</span> <span class="token string">&#39;--&gt;&#39;</span><span class="token punctuation">,</span> img_name<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&#39;png&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jpg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># 把验证集转化为COCO的json格式</span>\n    l2c_val <span class="token operator">=</span> Lableme2CoCo<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    val_instance <span class="token operator">=</span> l2c_val<span class="token punctuation">.</span>to_coco<span class="token punctuation">(</span>val_path<span class="token punctuation">)</span>\n    l2c_val<span class="token punctuation">.</span>save_coco_json<span class="token punctuation">(</span>val_instance<span class="token punctuation">,</span> <span class="token string">&#39;%scoco/annotations/instances_val2017.json&#39;</span> <span class="token operator">%</span> saved_coco_path<span class="token punctuation">)</span>\n</code></pre></div><h3 id="_3-通过脚本生成coco"><a class="header-anchor" href="#_3-通过脚本生成coco" aria-hidden="true">#</a> 3. 通过脚本生成coco</h3><p>记得改 04_MMLAB\\mmdetection-master\\mmdet\\datasets\\<a href="http://coco.py" target="_blank" rel="noopener noreferrer">coco.py</a></p><div class="language-python"><pre><code> CLASSES <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;mask&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;person&#39;</span><span class="token punctuation">)</span>\n PALETTE <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n</code></pre></div><p>记得改 04_MMLAB\\mmdetection-master\\mmdet\\core\\evaluation\\class_names.py</p><div class="language-python"><pre><code><span class="token keyword">def</span> <span class="token function">coco_classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n        <span class="token string">&#39;mask&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;person&#39;</span><span class="token punctuation">]</span>\n</code></pre></div><p>04_MMLAB\\mmdetection-master\\configs\\deformable_detr\\my_deformable_detr_r50_16x2_50e_coco.py 生成模型后要改Nums</p><h3 id="_4-配置文件数据增强"><a class="header-anchor" href="#_4-配置文件数据增强" aria-hidden="true">#</a> 4. 配置文件数据增强</h3><p>deformable_detr\\my_deformable_detr_r50_16x2_50e_coco.py</p><div class="language-python"><pre><code>dataset_type <span class="token operator">=</span> <span class="token string">&#39;CocoDataset&#39;</span>\ndata_root <span class="token operator">=</span> <span class="token string">&#39;data/coco/&#39;</span>\n<span class="token comment">#mmdet/core/evaluation/classnames.py中将coco_classes中的内容改成自己的</span>\n<span class="token comment">#mmdet/datasets/coco.py中将cocodatasets中的内容改成自己的</span>\n<span class="token comment">#num_classes改成自己的</span>\nimg_norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\ntrain_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadAnnotations&#39;</span><span class="token punctuation">,</span> with_bbox<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> flip_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;AutoAugment&#39;</span><span class="token punctuation">,</span>\n        policies<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token comment">#随机带走一个小朋友</span>\n            <span class="token string">&#39;type&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span>\n            <span class="token string">&#39;img_scale&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">544</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">576</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                          <span class="token punctuation">(</span><span class="token number">608</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">672</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">704</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                          <span class="token punctuation">(</span><span class="token number">736</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">768</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token string">&#39;multiscale_mode&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span><span class="token comment">#多尺度训练，在上面随机找一个</span>\n            <span class="token string">&#39;keep_ratio&#39;</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token comment">#True的时候以h和w中比例差异小的为基准倍数，对h和w按照相同比例resize（保持原有长宽比）</span>\n        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token comment">#False时直接按照上面大小resize</span>\n                  <span class="token punctuation">[</span><span class="token punctuation">{</span>\n                      <span class="token string">&#39;type&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span>\n                      <span class="token string">&#39;img_scale&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">4200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">4200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">4200</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                      <span class="token string">&#39;multiscale_mode&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span>\n                      <span class="token string">&#39;keep_ratio&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span>\n                  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n                      <span class="token string">&#39;type&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;RandomCrop&#39;</span><span class="token punctuation">,</span>\n                      <span class="token string">&#39;crop_type&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;absolute_range&#39;</span><span class="token punctuation">,</span>\n                      <span class="token string">&#39;crop_size&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                      <span class="token string">&#39;allow_negative_crop&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span>\n                  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n                      <span class="token string">&#39;type&#39;</span><span class="token punctuation">:</span>\n                      <span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span>\n                      <span class="token string">&#39;img_scale&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">544</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                    <span class="token punctuation">(</span><span class="token number">576</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">608</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                    <span class="token punctuation">(</span><span class="token number">672</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">704</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">736</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                    <span class="token punctuation">(</span><span class="token number">768</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                      <span class="token string">&#39;multiscale_mode&#39;</span><span class="token punctuation">:</span>\n                      <span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span>\n                      <span class="token string">&#39;override&#39;</span><span class="token punctuation">:</span>\n                      <span class="token boolean">True</span><span class="token punctuation">,</span>\n                      <span class="token string">&#39;keep_ratio&#39;</span><span class="token punctuation">:</span>\n                      <span class="token boolean">True</span>\n                  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DefaultFormatBundle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_bboxes&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_labels&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\ntest_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n        img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\n\ndata <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    samples_per_gpu<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n    workers_per_gpu<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CocoDataset&#39;</span><span class="token punctuation">,</span>\n        ann_file<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmdetection-master\\\\mmdet\\\\data\\\\labelme-data\\\\coco-formatcoco\\\\annotations\\\\instances_train2017.json&#39;</span><span class="token punctuation">,</span>\n        img_prefix<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmdetection-master\\\\mmdet\\\\data\\\\labelme-data\\\\coco-formatcoco\\\\images\\\\train2017&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadAnnotations&#39;</span><span class="token punctuation">,</span> with_bbox<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">,</span> flip_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;AutoAugment&#39;</span><span class="token punctuation">,</span>\n                policies<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">{</span>\n                    <span class="token string">&#39;type&#39;</span><span class="token punctuation">:</span>\n                    <span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span>\n                    <span class="token string">&#39;img_scale&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">544</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                  <span class="token punctuation">(</span><span class="token number">576</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">608</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                  <span class="token punctuation">(</span><span class="token number">672</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">704</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">736</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                  <span class="token punctuation">(</span><span class="token number">768</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                    <span class="token string">&#39;multiscale_mode&#39;</span><span class="token punctuation">:</span>\n                    <span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span>\n                    <span class="token string">&#39;keep_ratio&#39;</span><span class="token punctuation">:</span>\n                    <span class="token boolean">True</span>\n                <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                          <span class="token punctuation">[</span><span class="token punctuation">{</span>\n                              <span class="token string">&#39;type&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span>\n                              <span class="token string">&#39;img_scale&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">4200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">4200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                            <span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">4200</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                              <span class="token string">&#39;multiscale_mode&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span>\n                              <span class="token string">&#39;keep_ratio&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span>\n                          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n                              <span class="token string">&#39;type&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;RandomCrop&#39;</span><span class="token punctuation">,</span>\n                              <span class="token string">&#39;crop_type&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;absolute_range&#39;</span><span class="token punctuation">,</span>\n                              <span class="token string">&#39;crop_size&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                              <span class="token string">&#39;allow_negative_crop&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span>\n                          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n                              <span class="token string">&#39;type&#39;</span><span class="token punctuation">:</span>\n                              <span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span>\n                              <span class="token string">&#39;img_scale&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                            <span class="token punctuation">(</span><span class="token number">544</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">576</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                            <span class="token punctuation">(</span><span class="token number">608</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                            <span class="token punctuation">(</span><span class="token number">672</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">704</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                            <span class="token punctuation">(</span><span class="token number">736</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">768</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                                            <span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">1333</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                              <span class="token string">&#39;multiscale_mode&#39;</span><span class="token punctuation">:</span>\n                              <span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span>\n                              <span class="token string">&#39;override&#39;</span><span class="token punctuation">:</span>\n                              <span class="token boolean">True</span><span class="token punctuation">,</span>\n                              <span class="token string">&#39;keep_ratio&#39;</span><span class="token punctuation">:</span>\n                              <span class="token boolean">True</span>\n                          <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DefaultFormatBundle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_bboxes&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;gt_labels&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        filter_empty_gt<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CocoDataset&#39;</span><span class="token punctuation">,</span>\n        ann_file<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmdetection-master\\\\mmdet\\\\data\\\\labelme-data\\\\coco-formatcoco\\\\annotations\\\\instances_val2017.json&#39;</span><span class="token punctuation">,</span>\n        img_prefix<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmdetection-master\\\\mmdet\\\\data\\\\labelme-data\\\\coco-formatcoco\\\\images\\\\val2017&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n                <span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;CocoDataset&#39;</span><span class="token punctuation">,</span>\n        ann_file<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmdetection-master\\\\mmdet\\\\data\\\\labelme-data\\\\coco-formatcoco\\\\annotations\\\\instances_val2017.json&#39;</span><span class="token punctuation">,</span>\n        img_prefix<span class="token operator">=</span><span class="token string">&#39;D:\\\\eclipse-workspace\\\\PyTorch4\\\\mmdetection-master\\\\mmdet\\\\data\\\\labelme-data\\\\coco-formatcoco\\\\images\\\\val2017&#39;</span><span class="token punctuation">,</span>\n        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;LoadImageFromFile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleFlipAug&#39;</span><span class="token punctuation">,</span>\n                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n                transforms<span class="token operator">=</span><span class="token punctuation">[</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Resize&#39;</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;RandomFlip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Normalize&#39;</span><span class="token punctuation">,</span>\n                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pad&#39;</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ImageToTensor&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Collect&#39;</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n                <span class="token punctuation">]</span><span class="token punctuation">)</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nevaluation <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">&#39;bbox&#39;</span><span class="token punctuation">)</span>\ncheckpoint_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>\nlog_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> hooks<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;TextLoggerHook&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\ncustom_hooks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;NumClassCheckHook&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\ndist_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">&#39;nccl&#39;</span><span class="token punctuation">)</span>\nlog_level <span class="token operator">=</span> <span class="token string">&#39;INFO&#39;</span>\nload_from <span class="token operator">=</span> <span class="token string">&#39;./work_dirs/deformable_detr_r50_16x2_50e_coco/deformable_detr_r50_16x2_50e_coco_20210419_220030-a12b9512.pth&#39;</span>\n<span class="token comment">#https://github.com/open-mmlab/mmdetection/tree/master/configs/deformable_detr</span>\nresume_from <span class="token operator">=</span> <span class="token boolean">None</span>\nworkflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&#39;train&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\nopencv_num_threads <span class="token operator">=</span> <span class="token number">0</span>\nmp_start_method <span class="token operator">=</span> <span class="token string">&#39;fork&#39;</span>\nmodel <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DeformableDETR&#39;</span><span class="token punctuation">,</span>\n    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ResNet&#39;</span><span class="token punctuation">,</span>\n        depth<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>\n        num_stages<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>\n        out_indices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        frozen_stages<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;BN&#39;</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        norm_eval<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n        style<span class="token operator">=</span><span class="token string">&#39;pytorch&#39;</span><span class="token punctuation">,</span>\n        init_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;Pretrained&#39;</span><span class="token punctuation">,</span> checkpoint<span class="token operator">=</span><span class="token string">&#39;torchvision://resnet50&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    neck<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;ChannelMapper&#39;</span><span class="token punctuation">,</span>\n        in_channels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>\n        out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>\n        act_cfg<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;GN&#39;</span><span class="token punctuation">,</span> num_groups<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        num_outs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    bbox_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DeformableDETRHead&#39;</span><span class="token punctuation">,</span>\n        num_query<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span>\n        num_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>\n        in_channels<span class="token operator">=</span><span class="token number">2048</span><span class="token punctuation">,</span>\n        sync_cls_avg_factor<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n        as_two_stage<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        transformer<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DeformableDetrTransformer&#39;</span><span class="token punctuation">,</span>\n            encoder<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DetrTransformerEncoder&#39;</span><span class="token punctuation">,</span>\n                num_layers<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>\n                transformerlayers<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;BaseTransformerLayer&#39;</span><span class="token punctuation">,</span>\n                    attn_cfgs<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleDeformableAttention&#39;</span><span class="token punctuation">,</span> embed_dims<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    feedforward_channels<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span>\n                    ffn_dropout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>\n                    operation_order<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&#39;self_attn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;norm&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;ffn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;norm&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            decoder<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DeformableDetrTransformerDecoder&#39;</span><span class="token punctuation">,</span>\n                num_layers<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>\n                return_intermediate<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n                transformerlayers<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;DetrTransformerDecoderLayer&#39;</span><span class="token punctuation">,</span>\n                    attn_cfgs<span class="token operator">=</span><span class="token punctuation">[</span>\n                        <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiheadAttention&#39;</span><span class="token punctuation">,</span>\n                            embed_dims<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>\n                            num_heads<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>\n                            dropout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                        <span class="token builtin">dict</span><span class="token punctuation">(</span>\n                            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;MultiScaleDeformableAttention&#39;</span><span class="token punctuation">,</span>\n                            embed_dims<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">)</span>\n                    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n                    feedforward_channels<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span>\n                    ffn_dropout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>\n                    operation_order<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&#39;self_attn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;norm&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;cross_attn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;norm&#39;</span><span class="token punctuation">,</span>\n                                     <span class="token string">&#39;ffn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;norm&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        positional_encoding<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;SinePositionalEncoding&#39;</span><span class="token punctuation">,</span>\n            num_feats<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span>\n            normalize<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n            offset<span class="token operator">=</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        loss_cls<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;FocalLoss&#39;</span><span class="token punctuation">,</span>\n            use_sigmoid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n            gamma<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">,</span>\n            alpha<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>\n            loss_weight<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        loss_bbox<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;L1Loss&#39;</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        loss_iou<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;GIoULoss&#39;</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    train_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        assigner<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;HungarianAssigner&#39;</span><span class="token punctuation">,</span>\n            cls_cost<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;FocalLossCost&#39;</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            reg_cost<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;BBoxL1Cost&#39;</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token number">5.0</span><span class="token punctuation">,</span> box_format<span class="token operator">=</span><span class="token string">&#39;xywh&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            iou_cost<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;IoUCost&#39;</span><span class="token punctuation">,</span> iou_mode<span class="token operator">=</span><span class="token string">&#39;giou&#39;</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    test_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>max_per_img<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\noptimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>\n    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;AdamW&#39;</span><span class="token punctuation">,</span>\n    lr<span class="token operator">=</span><span class="token number">0.0002</span><span class="token punctuation">,</span>\n    weight_decay<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">,</span>\n    paramwise_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n        custom_keys<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>\n            backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>lr_mult<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            sampling_offsets<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>lr_mult<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            reference_points<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>lr_mult<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\noptimizer_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>grad_clip<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>max_norm<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> norm_type<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\nlr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>policy<span class="token operator">=</span><span class="token string">&#39;step&#39;</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\nrunner <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&#39;EpochBasedRunner&#39;</span><span class="token punctuation">,</span> max_epochs<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>\nwork_dir <span class="token operator">=</span> <span class="token string">&#39;./work_dirs/deformable_detr_r50_16x2_50e_coco&#39;</span>\nauto_resume <span class="token operator">=</span> <span class="token boolean">False</span>\ngpu_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\n\n</code></pre></div><h3 id="_5-训练配置"><a class="header-anchor" href="#_5-训练配置" aria-hidden="true">#</a> 5. 训练配置</h3><h2 id="_6-第三模块：deformabledetr物体检测源码分析"><a class="header-anchor" href="#_6-第三模块：deformabledetr物体检测源码分析" aria-hidden="true">#</a> 6. 第三模块：DeformableDetr物体检测源码分析</h2><p><a href="https://github.com/fundamentalvision/Deformable-DETR" target="_blank" rel="noopener noreferrer">https://github.com/fundamentalvision/Deformable-DETR</a></p><p>论文：By <a href="https://scholar.google.com/citations?user=02RXI00AAAAJ" target="_blank" rel="noopener noreferrer">Xizhou Zhu</a>, <a href="https://www.weijiesu.com/" target="_blank" rel="noopener noreferrer">Weijie Su</a>, <a href="https://www.linkedin.com/in/lewei-lu-94015977/" target="_blank" rel="noopener noreferrer">Lewei Lu</a>, <a href="http://staff.ustc.edu.cn/~binli/" target="_blank" rel="noopener noreferrer">Bin Li</a>, <a href="http://www.ee.cuhk.edu.hk/~xgwang/" target="_blank" rel="noopener noreferrer">Xiaogang Wang</a>, <a href="https://jifengdai.org/" target="_blank" rel="noopener noreferrer">Jifeng Dai</a>.</p><p><a href="https://arxiv.org/abs/2010.04159" target="_blank" rel="noopener noreferrer">Deformable DETR: Deformable Transformers for End-to-End Object Detection</a>.</p><p>mmvc最好用1.4.2</p><h2 id="_7-第四模块：dbnet文字检测"><a class="header-anchor" href="#_7-第四模块：dbnet文字检测" aria-hidden="true">#</a> 7. 第四模块：DBNET文字检测</h2><p><a href="https://rrc.cvc.uab.es/?ch=4&amp;com=tasks" target="_blank" rel="noopener noreferrer">https://rrc.cvc.uab.es/?ch=4&amp;com=tasks</a></p><p>论文：DBNET</p><p>项目：mmocr</p>',187);t.render=function(a,p,t,e,c,l){return n(),s("div",null,[o])};export default t;export{p as __pageData};
